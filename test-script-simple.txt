// PASTE THIS IN GOOGLE APPS SCRIPT TO TEST

function doPost(e) {
  try {
    // Log everything for debugging
    Logger.log('doPost called');
    Logger.log('Parameters: ' + JSON.stringify(e.parameter));
    
    var spreadsheetId = "1QignXZqzzBlr2qQolWA7jZr78FGebvzbZPUI7-gQbSA";
    var ss = SpreadsheetApp.openById(spreadsheetId);
    var sheet = ss.getSheets()[0];
    
    Logger.log('Sheet name: ' + sheet.getName());
    
    var fullName = e.parameter.fullName || 'NO NAME';
    var email = e.parameter.email || 'NO EMAIL';
    var phone = e.parameter.phone || 'NO PHONE';
    var message = e.parameter.message || 'NO MESSAGE';
    var timestamp = new Date();
    
    Logger.log('Adding row: ' + [timestamp, fullName, email, phone, message]);
    
    sheet.appendRow([timestamp, fullName, email, phone, message]);
    
    Logger.log('Row added successfully');
    
    return ContentService
      .createTextOutput(JSON.stringify({'result': 'success', 'message': 'Data saved'}))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    Logger.log('ERROR: ' + error.toString());
    return ContentService
      .createTextOutput(JSON.stringify({'result': 'error', 'error': error.toString()}))
      .setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService.createTextOutput("Script is running!");
}

// Test function - click Run to test manually
function testManually() {
  var testData = {
    parameter: {
      fullName: 'Manual Test',
      email: 'test@test.com',
      phone: '1234567890',
      message: 'This is a manual test'
    }
  };
  
  var result = doPost(testData);
  Logger.log('Test result: ' + result.getContent());
}
