<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Performance Debug - Extoll.Co</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #0A0A0D; color: white; }
        .test-section { margin: 20px 0; padding: 20px; border: 1px solid #333; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; background: #1a1a1a; border-radius: 4px; }
        .good { border-left: 4px solid #00ff00; }
        .warning { border-left: 4px solid #ffaa00; }
        .error { border-left: 4px solid #ff0000; }
        img { max-width: 200px; margin: 10px; border: 1px solid #333; }
        .loading { opacity: 0.5; }
    </style>
</head>
<body>
    <h1>Extoll.Co Performance Debug Tool</h1>
    
    <div class="test-section">
        <h2>1. Image Loading Speed Test</h2>
        <div id="image-results"></div>
        
        <h3>Original Size Images (Current)</h3>
        <img id="img1" src="https://lnxvkbsbwymmzkyuixgd.supabase.co/storage/v1/object/public/design-portfolio/thumbnail/festival.png?width=300&height=240&resize=cover&quality=50&format=webp" alt="Optimized">
        
        <h3>Smaller Size Test</h3>
        <img id="img2" src="https://lnxvkbsbwymmzkyuixgd.supabase.co/storage/v1/object/public/design-portfolio/thumbnail/festival.png?width=200&height=160&resize=cover&quality=30&format=webp" alt="More Optimized">
        
        <h3>No Transformation Test</h3>
        <img id="img3" src="https://lnxvkbsbwymmzkyuixgd.supabase.co/storage/v1/object/public/design-portfolio/thumbnail/festival.png" alt="Original">
    </div>
    
    <div class="test-section">
        <h2>2. Network Performance</h2>
        <div id="network-results"></div>
    </div>
    
    <div class="test-section">
        <h2>3. JavaScript Performance</h2>
        <div id="js-results"></div>
    </div>
    
    <div class="test-section">
        <h2>4. Service Worker Status</h2>
        <div id="sw-results"></div>
    </div>

    <script>
        // Performance monitoring
        const results = {
            images: {},
            network: {},
            javascript: {},
            serviceWorker: {}
        };

        // Test image loading speeds
        function testImageLoading() {
            const images = document.querySelectorAll('img');
            const imageResults = document.getElementById('image-results');
            
            images.forEach((img, index) => {
                const startTime = performance.now();
                img.classList.add('loading');
                
                img.onload = function() {
                    const loadTime = performance.now() - startTime;
                    img.classList.remove('loading');
                    
                    const result = document.createElement('div');
                    result.className = `result ${loadTime < 500 ? 'good' : loadTime < 1000 ? 'warning' : 'error'}`;
                    result.innerHTML = `Image ${index + 1}: ${loadTime.toFixed(2)}ms - ${img.alt}`;
                    imageResults.appendChild(result);
                    
                    results.images[`img${index + 1}`] = loadTime;
                };
                
                img.onerror = function() {
                    const result = document.createElement('div');
                    result.className = 'result error';
                    result.innerHTML = `Image ${index + 1}: FAILED TO LOAD - ${img.alt}`;
                    imageResults.appendChild(result);
                };
            });
        }

        // Test network performance
        function testNetworkPerformance() {
            const networkResults = document.getElementById('network-results');
            
            // Test connection speed
            if ('connection' in navigator) {
                const connection = navigator.connection;
                const result = document.createElement('div');
                result.className = 'result good';
                result.innerHTML = `
                    Connection Type: ${connection.effectiveType}<br>
                    Downlink: ${connection.downlink} Mbps<br>
                    RTT: ${connection.rtt}ms
                `;
                networkResults.appendChild(result);
            }
            
            // Test DNS resolution
            const dnsStart = performance.now();
            fetch('https://lnxvkbsbwymmzkyuixgd.supabase.co/storage/v1/object/public/design-portfolio/thumbnail/festival.png?width=1&height=1', {method: 'HEAD'})
                .then(() => {
                    const dnsTime = performance.now() - dnsStart;
                    const result = document.createElement('div');
                    result.className = `result ${dnsTime < 200 ? 'good' : dnsTime < 500 ? 'warning' : 'error'}`;
                    result.innerHTML = `Supabase DNS + Connection: ${dnsTime.toFixed(2)}ms`;
                    networkResults.appendChild(result);
                })
                .catch(err => {
                    const result = document.createElement('div');
                    result.className = 'result error';
                    result.innerHTML = `Supabase Connection: FAILED - ${err.message}`;
                    networkResults.appendChild(result);
                });
        }

        // Test JavaScript performance
        function testJavaScriptPerformance() {
            const jsResults = document.getElementById('js-results');
            
            // Test DOM manipulation speed
            const domStart = performance.now();
            for (let i = 0; i < 1000; i++) {
                const div = document.createElement('div');
                div.textContent = 'test';
            }
            const domTime = performance.now() - domStart;
            
            const result = document.createElement('div');
            result.className = `result ${domTime < 10 ? 'good' : domTime < 50 ? 'warning' : 'error'}`;
            result.innerHTML = `DOM Manipulation (1000 elements): ${domTime.toFixed(2)}ms`;
            jsResults.appendChild(result);
            
            // Test animation performance
            const animStart = performance.now();
            let frames = 0;
            function countFrames() {
                frames++;
                if (frames < 60) {
                    requestAnimationFrame(countFrames);
                } else {
                    const animTime = performance.now() - animStart;
                    const fps = 60000 / animTime;
                    const result = document.createElement('div');
                    result.className = `result ${fps > 55 ? 'good' : fps > 30 ? 'warning' : 'error'}`;
                    result.innerHTML = `Animation Performance: ${fps.toFixed(1)} FPS`;
                    jsResults.appendChild(result);
                }
            }
            requestAnimationFrame(countFrames);
        }

        // Test service worker
        function testServiceWorker() {
            const swResults = document.getElementById('sw-results');
            
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.getRegistrations().then(registrations => {
                    const result = document.createElement('div');
                    if (registrations.length > 0) {
                        result.className = 'result good';
                        result.innerHTML = `Service Worker: ACTIVE (${registrations.length} registered)`;
                    } else {
                        result.className = 'result warning';
                        result.innerHTML = 'Service Worker: NOT REGISTERED';
                    }
                    swResults.appendChild(result);
                });
                
                // Test cache
                if ('caches' in window) {
                    caches.keys().then(cacheNames => {
                        const result = document.createElement('div');
                        result.className = 'result good';
                        result.innerHTML = `Cache Storage: ${cacheNames.length} caches found`;
                        swResults.appendChild(result);
                    });
                }
            } else {
                const result = document.createElement('div');
                result.className = 'result error';
                result.innerHTML = 'Service Worker: NOT SUPPORTED';
                swResults.appendChild(result);
            }
        }

        // Run all tests
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Starting performance tests...');
            
            testImageLoading();
            testNetworkPerformance();
            testJavaScriptPerformance();
            testServiceWorker();
            
            // Summary after 5 seconds
            setTimeout(() => {
                console.log('Performance Test Results:', results);
                
                const summary = document.createElement('div');
                summary.className = 'test-section';
                summary.innerHTML = '<h2>Summary & Recommendations</h2>';
                
                // Analyze results and provide recommendations
                const avgImageTime = Object.values(results.images).reduce((a, b) => a + b, 0) / Object.values(results.images).length;
                
                if (avgImageTime > 1000) {
                    summary.innerHTML += '<div class="result error">ðŸš¨ CRITICAL: Images taking >1s to load. Consider CDN or smaller images.</div>';
                } else if (avgImageTime > 500) {
                    summary.innerHTML += '<div class="result warning">âš ï¸ WARNING: Images taking >500ms to load. Room for improvement.</div>';
                } else {
                    summary.innerHTML += '<div class="result good">âœ… GOOD: Image loading performance is acceptable.</div>';
                }
                
                document.body.appendChild(summary);
            }, 5000);
        });
    </script>
</body>
</html>