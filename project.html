<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-9JGM53RNSQ"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'G-9JGM53RNSQ');
    </script>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />
    <title>Project Details - Extoll.Co</title>
    <link rel="icon" type="image/png" href="favicon.webp">
    <link rel="apple-touch-icon" href="favicon.webp">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preconnect" href="https://lvtkoryorwzknxzfpyzz.supabase.co" crossorigin>
    <link rel="preconnect" href="https://lvtkoryorwzknxzfpyzz.supabase.co/storage/v1" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300..700&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="styles.css">
    <!-- Tailwind CSS (pre-built) -->`n
    <link rel="stylesheet" href="tailwind-output.css">
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            const shouldBeDark = savedTheme === 'dark' || (!savedTheme && true);
            if (shouldBeDark) { document.documentElement.classList.add('dark'); }
        })();
    </script>
    <style>
        :root {
            --colors-primary: #1a1a1a;
            --colors-primary-rgb: 26, 26, 26;
        }

        .dark {
            --colors-primary: #00aaff;
            --colors-primary-rgb: 0, 170, 255;
        }

        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .dark .glass-card {
            background: rgba(28, 38, 48, 0.8);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        .glass-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 30px rgba(0, 170, 255, 0.15);
        }

        #project-description {
            white-space: pre-wrap;
            word-wrap: break-word;
            line-height: 1.8;
        }
    </style>
</head>

<body
    class="bg-background-light dark:bg-background-dark font-display text-slate-900 dark:text-white overflow-x-hidden min-h-screen">
    <!-- Global Header -->
    <script src="global-header.js"></script>

    <div class="relative flex min-h-screen w-full flex-col">

        <div class="layout-container flex h-full grow flex-col">
            <div class="px-4 sm:px-10 lg:px-40 flex flex-1 justify-center py-5">
                <div class="layout-content-container flex flex-col w-full max-w-[960px] flex-1">
                    <!-- Main Content -->
                    <main class="flex-1 py-12 md:py-16">
                        <!-- Project Not Found -->
                        <div id="project-not-found" class="hidden text-center px-4 py-20">
                            <div class="glass-card p-12 rounded-2xl max-w-md mx-auto">
                                <div class="text-6xl mb-6">üîç</div>
                                <h1 class="text-3xl font-bold mb-4">Project Not Found</h1>
                                <p class="text-slate-500 dark:text-gray-400 mb-6">The project you're looking for doesn't
                                    exist or hasn't been added yet.</p>
                                <a href="portfolio.html"
                                    class="inline-block bg-primary text-white px-6 py-3 rounded-lg font-bold hover:bg-primary/90 transition-colors">
                                    Back to Portfolio
                                </a>
                            </div>
                        </div>

                        <!-- Project Content -->
                        <div id="project-content" class="hidden">
                            <!-- Back Link -->
                            <div class="mb-8">
                                <a href="portfolio.html"
                                    class="inline-flex items-center gap-2 text-slate-500 dark:text-[#9cabba] hover:text-primary transition-colors text-sm font-medium">
                                    <span class="material-symbols-outlined text-lg">arrow_back</span>
                                    Back to Portfolio
                                </a>
                            </div>

                            <!-- Project Title -->
                            <section class="mb-12">
                                <div class="flex items-start gap-3 mb-4">
                                    <span class="h-px w-8 bg-primary mt-4"></span>
                                    <span class="text-primary font-bold tracking-widest uppercase text-sm"
                                        id="project-category">Graphics Design</span>
                                </div>
                                <h1 class="text-4xl md:text-5xl lg:text-6xl font-black leading-tight tracking-[-0.033em]"
                                    id="project-title">
                                    Loading...
                                </h1>
                            </section>

                            <!-- Project Hero Image -->
                            <section class="mb-16">
                                <div class="w-full rounded-2xl overflow-hidden bg-gray-200 dark:bg-[#1c2630] min-h-[300px] md:min-h-[400px] lg:min-h-[500px] shadow-xl"
                                    id="project-hero">
                                    <!-- Hero image will be set via JavaScript -->
                                </div>
                            </section>

                            <!-- Project Gallery -->
                            <section class="mb-16" id="project-gallery">
                                <div
                                    class="flex items-end justify-between mb-8 border-b border-gray-200 dark:border-[#27343a] pb-4">
                                    <h2 class="text-2xl md:text-3xl font-bold tracking-tight">Project Gallery</h2>
                                    <span class="text-slate-500 dark:text-[#9cabba] text-sm" id="project-count">0
                                        Files</span>
                                </div>
                                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4" id="gallery-grid">
                                    <!-- Gallery images will be populated by JavaScript -->
                                </div>
                            </section>

                            <!-- Project Description -->
                            <section class="mb-16">
                                <h2 class="text-2xl md:text-3xl font-bold tracking-tight mb-6">About This Project</h2>
                                <div class="glass-card p-8 rounded-2xl">
                                    <p class="text-slate-600 dark:text-[#cadce7] text-lg leading-relaxed"
                                        id="project-description">
                                        Loading project description...
                                    </p>
                                </div>
                            </section>

                            <!-- CTA Section -->
                            <section
                                class="py-16 text-center relative rounded-2xl overflow-hidden bg-gradient-to-br from-primary/10 to-primary/5 dark:from-primary/20 dark:to-primary/5 border border-primary/20">
                                <div class="absolute inset-0 opacity-10"
                                    style="background-image: radial-gradient(circle at center, #00aaff 0%, transparent 70%);">
                                </div>
                                <div class="relative z-10">
                                    <h2 class="text-3xl md:text-4xl font-black mb-4">Like What You See?</h2>
                                    <p class="text-slate-600 dark:text-slate-300 max-w-lg mx-auto mb-8">Have a similar
                                        project in mind? Let's collaborate and create something extraordinary together.
                                    </p>
                                    <a href="contact.html">
                                        <button
                                            class="inline-flex items-center justify-center rounded-lg h-14 px-8 bg-primary hover:bg-primary/90 transition-all text-white text-base font-bold tracking-[0.015em] shadow-lg">
                                            Start Your Project
                                        </button>
                                    </a>
                                </div>
                            </section>
                        </div>
                    </main>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="border-t border-gray-200 dark:border-[#27343a] bg-gray-50 dark:bg-[#0b1419] py-8">
            <div
                class="max-w-[1280px] mx-auto px-4 sm:px-6 lg:px-8 flex flex-col md:flex-row justify-between items-center gap-6">
                <p class="text-slate-400 text-sm">¬© 2026 Extoll.Co. All rights reserved.</p>
                <div class="flex gap-6">
                    <a class="text-slate-400 hover:text-primary transition-colors" href="https://instagram.com/extollco"
                        target="_blank">
                        <span class="material-symbols-outlined text-xl">photo_camera</span>
                    </a>
                    <a class="text-slate-400 hover:text-primary transition-colors" href="mailto:extoll.co.in@gmail.com">
                        <span class="material-symbols-outlined text-xl">mail</span>
                    </a>
                </div>
            </div>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js" crossorigin></script>
    <script src="supabase-config.js"></script>
    <script src="website-assets.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (!initializeSupabase()) {
                console.error('Failed to initialize Supabase');
                loadFromLocalStorage();
                return;
            }

            const urlParams = new URLSearchParams(window.location.search);
            const projectKey = urlParams.get('project');

            if (!projectKey) {
                showProjectNotFound();
                return;
            }

            loadProjectFromSupabase(projectKey);
        });

        async function loadProjectFromSupabase(projectKey) {
            const result = await getProjectByKey(projectKey);
            if (result.success) {
                loadProject(result.data);
            } else {
                loadFromLocalStorage(projectKey);
            }
        }

        function loadFromLocalStorage(projectKey) {
            const projects = JSON.parse(localStorage.getItem('projects') || '[]');
            const project = projects.find(p => p.key === projectKey);

            if (!project) {
                showProjectNotFound();
                return;
            }

            const formattedProject = {
                id: project.id,
                title: project.title,
                key: project.key,
                category: project.category,
                description: project.description,
                count: project.count,
                thumbnail_url: project.thumbnailDataUrl,
                created_at: project.createdAt,
                project_images: project.images || [],
                project_videos: project.videos || []
            };

            loadProject(formattedProject);
        }

        function showProjectNotFound() {
            document.getElementById('project-not-found').classList.remove('hidden');
            document.getElementById('project-content').classList.add('hidden');
        }

        function loadProject(project) {
            document.getElementById('project-content').classList.remove('hidden');
            document.getElementById('project-not-found').classList.add('hidden');

            document.title = `${project.title} - Extoll.Co`;
            document.getElementById('project-title').textContent = project.title;
            document.getElementById('project-category').textContent = getCategoryDisplayName(project.category);

            const heroElement = document.getElementById('project-hero');
            if (project.thumbnail_url) {
                heroElement.style.backgroundImage = `url(${project.thumbnail_url})`;
                heroElement.style.backgroundSize = 'cover';
                heroElement.style.backgroundPosition = 'center';
            } else {
                const initial = (project.title || 'P').charAt(0).toUpperCase();
                heroElement.innerHTML = `
          <div class="w-full h-full bg-gradient-to-br from-primary/30 to-primary/10 flex items-center justify-center min-h-[400px]">
            <span class="text-8xl font-black text-primary/50">${initial}</span>
          </div>
        `;
            }

            const description = project.description || 'No description available for this project.';
            document.getElementById('project-description').textContent = description;

            loadProjectFilesFromStorage(project.key, project.category);
        }

        async function loadProjectFilesFromStorage(projectKey, projectCategory) {
            const galleryGrid = document.getElementById('gallery-grid');

            galleryGrid.innerHTML = `
        <div class="col-span-full glass-card p-12 rounded-xl text-center">
          <div class="animate-pulse">
            <div class="text-4xl mb-4">üì∑</div>
            <p class="text-slate-500">Loading project files...</p>
          </div>
        </div>
      `;

            try {
                // Check sessionStorage first for instant load
                const cacheKey = `project_files_${projectKey}`;
                const cachedFiles = sessionStorage.getItem(cacheKey);

                let filteredFiles = [];

                if (cachedFiles) {
                    filteredFiles = JSON.parse(cachedFiles);
                } else {
                    const { data: files, error } = await configSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .list(projectKey, { limit: 1000, sortBy: { column: 'created_at', order: 'desc' } });

                    if (error || !files || files.length === 0) {
                        showNoFilesMessage();
                        return;
                    }

                    filteredFiles = files.filter(file => {
                        const fileName = file.name.toLowerCase();
                        return !fileName.startsWith('logo') &&
                            !fileName.startsWith('banner') &&
                            !fileName.startsWith('thumb-') &&
                            !fileName.endsWith('.json');
                    });

                    // Cache the file list so subsequent visits to the same project are instant
                    try {
                        sessionStorage.setItem(cacheKey, JSON.stringify(filteredFiles));
                    } catch (e) {
                        console.warn('Could not cache file list', e);
                    }
                }

                const projectFiles = filteredFiles.map(file => {
                    const filePath = `${projectKey}/${file.name}`;
                    const { data: urlData } = configSupabase.storage.from(SUPABASE_CONFIG.bucket).getPublicUrl(filePath);
                    return {
                        name: file.name,
                        path: filePath,
                        url: urlData.publicUrl,
                        type: getFileType(file.name),
                        created_at: file.created_at
                    };
                });

                window.currentProjectFiles = projectFiles;
                const fileCount = projectFiles.length;
                document.getElementById('project-count').textContent = `${fileCount} File${fileCount !== 1 ? 's' : ''}`;

                if (projectFiles.length > 0) {
                    galleryGrid.innerHTML = projectFiles.map((file, index) => {
                        // Priority loading for first 4 images to make above-the-fold content pop immediately
                        const isPriority = index < 4;
                        const loadingAttr = isPriority ? 'eager' : 'lazy';
                        const fetchPriority = isPriority ? 'high' : 'auto';

                        if (file.type === 'image') {
                            return `
                <div class="glass-card rounded-xl overflow-hidden aspect-square relative group cursor-pointer transition-all duration-300" onclick="openLightbox(${index})">
                  <div class="absolute inset-0 bg-gradient-to-br from-primary/10 to-primary/5 animate-pulse"></div>
                  <img 
                    src="${file.url}" 
                    alt="Project Image" 
                    class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105 opacity-0" 
                    loading="${loadingAttr}"
                    fetchpriority="${fetchPriority}"
                    decoding="${isPriority ? 'sync' : 'async'}"
                    onload="this.style.opacity='1'; this.previousElementSibling.style.display='none'"
                    onerror="this.previousElementSibling.classList.remove('animate-pulse'); this.previousElementSibling.innerHTML='<div class=\\'w-full h-full flex items-center justify-center\\'><span class=\\'material-symbols-outlined text-4xl text-red-500/50\\'>broken_image</span></div>'"
                  >
                  <div class="absolute inset-0 bg-black/0 group-hover:bg-black/20 transition-all duration-300 flex items-center justify-center opacity-0 group-hover:opacity-100">
                    <span class="material-symbols-outlined text-white text-3xl">zoom_in</span>
                  </div>
                </div>
              `;
                        } else if (file.type === 'video') {
                            return `
                <div class="glass-card rounded-xl overflow-hidden aspect-square relative group cursor-pointer transition-all duration-300" onclick="openLightbox(${index})">
                  <video class="w-full h-full object-cover" preload="metadata">
                    <source src="${file.url}" type="video/mp4">
                  </video>
                  <div class="absolute inset-0 bg-black/50 flex items-center justify-center group-hover:bg-black/30 transition-all duration-300">
                    <span class="material-symbols-outlined text-white text-5xl">play_circle</span>
                  </div>
                </div>
              `;
                        }
                        return '';
                    }).join('');
                } else {
                    showNoFilesMessage();
                }
            } catch (error) {
                console.error('Error loading project files:', error);
                showNoFilesMessage();
            }
        }

        function showNoFilesMessage() {
            const galleryGrid = document.getElementById('gallery-grid');
            galleryGrid.innerHTML = `
        <div class="col-span-full glass-card p-12 rounded-xl text-center">
          <div class="text-4xl mb-4">üì∑</div>
          <h3 class="text-xl font-bold mb-2">No Files Yet</h3>
          <p class="text-slate-500 dark:text-gray-400">Project files will appear here when uploaded.</p>
        </div>
      `;
        }

        function getFileType(fileName) {
            const ext = fileName.split('.').pop().toLowerCase();
            if (['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'].includes(ext)) return 'image';
            if (['mp4', 'webm', 'mov', 'avi', 'mkv'].includes(ext)) return 'video';
            return 'other';
        }

        function getCategoryDisplayName(category) {
            const map = {
                'graphics': 'Graphics Design',
                'ui': 'UI/UX Design',
                'product': 'Product Design',
                'animation': '2D Animation',
                'video': 'Video Editing'
            };
            return map[category] || 'Design';
        }

        function openLightbox(startIndex) {
            const files = (window.currentProjectFiles || []).filter(f => f.type === 'image' || f.type === 'video');
            if (files.length === 0) return;

            let currentIndex = startIndex;
            const lightbox = document.createElement('div');
            lightbox.className = 'fixed inset-0 bg-black/95 z-50 flex items-center justify-center p-4';
            lightbox.id = 'lightbox-modal';

            function updateContent() {
                const file = files[currentIndex];
                const isVideo = file.type === 'video';
                lightbox.innerHTML = `
          <div class="relative max-w-6xl max-h-full flex items-center justify-center">
            ${isVideo ? `
              <video controls class="max-w-full max-h-[90vh]" autoplay>
                <source src="${file.url}" type="video/mp4">
              </video>
            ` : `
              <img src="${file.url}" alt="Project Image" class="max-w-full max-h-[90vh] object-contain">
            `}
            <button onclick="closeLightbox()" class="absolute top-4 right-4 text-white text-3xl bg-black/70 rounded-full w-12 h-12 flex items-center justify-center hover:bg-black/90 transition-all z-10">
              <span class="material-symbols-outlined">close</span>
            </button>
            ${files.length > 1 ? `
              <button onclick="prevMedia()" class="absolute left-4 top-1/2 -translate-y-1/2 text-white text-2xl bg-black/70 rounded-full w-12 h-12 flex items-center justify-center hover:bg-black/90 transition-all z-10 ${currentIndex === 0 ? 'opacity-50' : ''}">
                <span class="material-symbols-outlined">chevron_left</span>
              </button>
              <button onclick="nextMedia()" class="absolute right-4 top-1/2 -translate-y-1/2 text-white text-2xl bg-black/70 rounded-full w-12 h-12 flex items-center justify-center hover:bg-black/90 transition-all z-10 ${currentIndex === files.length - 1 ? 'opacity-50' : ''}">
                <span class="material-symbols-outlined">chevron_right</span>
              </button>
              <div class="absolute bottom-4 left-1/2 -translate-x-1/2 text-white bg-black/70 px-4 py-2 rounded-full text-sm">
                ${currentIndex + 1} / ${files.length}
              </div>
            ` : ''}
          </div>
        `;
            }

            window.closeLightbox = () => { lightbox.remove(); };
            window.prevMedia = () => { if (currentIndex > 0) { currentIndex--; updateContent(); } };
            window.nextMedia = () => { if (currentIndex < files.length - 1) { currentIndex++; updateContent(); } };

            function handleKey(e) {
                if (e.key === 'Escape') closeLightbox();
                if (e.key === 'ArrowLeft') prevMedia();
                if (e.key === 'ArrowRight') nextMedia();
            }
            document.addEventListener('keydown', handleKey);

            const origClose = window.closeLightbox;
            window.closeLightbox = () => { document.removeEventListener('keydown', handleKey); origClose(); };

            lightbox.addEventListener('click', (e) => { if (e.target === lightbox) closeLightbox(); });

            updateContent();
            document.body.appendChild(lightbox);
        }
    </script>
</body>

</html>