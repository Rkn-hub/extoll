<!DOCTYPE html>
<html class="dark" lang="en">

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=2.0, user-scalable=yes"
        name="viewport" />
    <title>Dashboard</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="apple-touch-icon" href="favicon.png">
    <meta name="robots" content="noindex, nofollow, noarchive, nosnippet">
    <meta name="referrer" content="no-referrer">
    <!-- Security Headers -->
    <script>
        // Basic security measures
        if (window.location.protocol !== 'https:' &&
            window.location.hostname !== 'localhost' &&
            window.location.hostname !== '127.0.0.1') {
            window.location.href = 'https:' + window.location.href.substring(window.location.protocol.length);
        }
        // Disable right-click context menu
        document.addEventListener('contextmenu', function (e) {
            e.preventDefault();
        });
        // Disable F12, Ctrl+Shift+I, Ctrl+U
        document.addEventListener('keydown', function (e) {
            if (e.key === 'F12' ||
                (e.ctrlKey && e.shiftKey && e.key === 'I') ||
                (e.ctrlKey && e.key === 'u')) {
                e.preventDefault();
            }
        });
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;700&display=swap"
        rel="stylesheet" />
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
    <!-- Theme Initialization -->
    <script>
        (function () {
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        })();
    </script>
    <style>
        html {
            font-size: 18px;
        }

        body {
            background: linear-gradient(135deg, #0A0A0D 0%, #1a1a2e 50%, #16213e 100%);
            color: #e5e7eb;
            font-family: 'Space Grotesk', sans-serif;
            min-height: 100vh;
            /* zoom: 1.1; Removed to prevent shaking/scrolling issues */
            overscroll-behavior: none;
            scroll-behavior: smooth;
        }

        @keyframes float {
            0% {
                transform: translate(0px, 0px) scale(1);
            }

            33% {
                transform: translate(30px, -50px) scale(1.1);
            }

            66% {
                transform: translate(-20px, 20px) scale(0.9);
            }

            100% {
                transform: translate(0px, 0px) scale(1);
            }
        }

        .animate-float {
            animation: float 20s infinite ease-in-out;
        }

        .animate-float-delay {
            animation: float 15s infinite ease-in-out reverse;
        }

        .glass-card {
            background: rgba(15, 23, 42, 0.85);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(51, 65, 85, 0.4);
            transition: all 0.3s ease-in-out;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
        }

        .btn-primary {
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            color: white;
            padding: 20px 40px;
            border: none;
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(14, 165, 233, 0.25);
            font-size: 18px;
            min-height: 64px;
        }

        .btn-secondary {
            background: rgba(14, 165, 233, 0.1);
            color: #0ea5e9;
            padding: 16px 32px;
            border: 2px solid rgba(14, 165, 233, 0.4);
            border-radius: 12px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            font-size: 16px;
            min-height: 56px;
        }

        .form-input {
            background: rgba(15, 23, 42, 0.9) !important;
            border: 2px solid rgba(51, 65, 85, 0.6) !important;
            color: #e2e8f0 !important;
            padding: 20px 24px !important;
            border-radius: 12px !important;
            width: 100% !important;
            transition: all 0.3s ease !important;
            backdrop-filter: blur(10px) !important;
            font-size: 18px !important;
            min-height: 64px !important;
        }

        .form-textarea {
            background: rgba(15, 23, 42, 0.9) !important;
            border: 2px solid rgba(51, 65, 85, 0.6) !important;
            color: #e2e8f0 !important;
            padding: 16px 20px !important;
            border-radius: 12px !important;
            width: 100% !important;
            min-height: 140px !important;
            resize: vertical !important;
            transition: all 0.3s ease !important;
            backdrop-filter: blur(10px) !important;
            font-family: inherit !important;
            font-size: 16px !important;
        }

        .upload-area {
            border: 3px dashed rgba(14, 165, 233, 0.4);
            background: rgba(14, 165, 233, 0.05);
            border-radius: 16px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .upload-area:hover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            box-shadow: 0 8px 25px rgba(14, 165, 233, 0.15);
            transform: translateY(-2px);
        }

        .upload-area.dragover {
            border-color: #0ea5e9;
            background: rgba(14, 165, 233, 0.2);
            transform: scale(1.02);
        }

        .tab-button {
            padding: 18px 36px;
            background: rgba(15, 23, 42, 0.6);
            border: none;
            color: #94a3b8;
            font-weight: 600;
            cursor: pointer;
            border-radius: 12px 12px 0 0;
            transition: all 0.3s ease;
            margin-right: 4px;
            font-size: 16px;
        }

        .tab-button.active {
            color: #0ea5e9;
            background: rgba(14, 165, 233, 0.1);
            border-bottom: 3px solid #0ea5e9;
        }

        .notification {
            position: fixed;
            top: 24px;
            right: 24px;
            padding: 16px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            z-index: 1000;
            transform: translateX(400px);
            transition: all 0.4s ease;
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: linear-gradient(135deg, #059669 0%, #047857 100%);
        }

        .notification.error {
            background: linear-gradient(135deg, #dc2626 0%, #b91c1c 100%);
        }

        /* Cursor styles for all interactive elements */
        button,
        .cursor-pointer,
        .tab-button,
        .btn-primary,
        .btn-secondary,
        .upload-area,
        [onclick],
        [data-tab],
        input[type="submit"],
        input[type="file"],
        select,
        .project-tile,
        .asset-item {
            cursor: pointer !important;
        }

        /* Ensure disabled buttons show not-allowed cursor */
        button:disabled,
        input:disabled,
        select:disabled {
            cursor: not-allowed !important;
        }

        /* Specific cursor for drag and drop areas */
        .upload-area.dragover {
            cursor: copy !important;
        }

        .hidden {
            display: none;
        }

        /* Force white text inside glass cards for Light Mode */
        .glass-card .text-gray-600,
        .glass-card .text-gray-700,
        .glass-card .text-gray-800,
        .glass-card .text-gray-900,
        .glass-card .text-black,
        .glassmorphism .text-gray-600,
        .glassmorphism .text-gray-700,
        .glassmorphism .text-gray-800,
        .glassmorphism .text-gray-900,
        .glassmorphism .text-black {
            color: #1a1a1a !important;
        }

        /* Ensure muted text is slightly transparent white instead of gray */
        .glass-card .text-gray-500,
        .glassmorphism .text-gray-500 {
            color: rgba(255, 255, 255, 0.7) !important;
        }

        /* FIX: Restore DARK text for content inside light-colored inner cards (like Team/How We Work) */
        /* Target elements inside bg-gray-100 or bg-white that are inside glass cards */
        .glass-card .bg-gray-100 .text-gray-600,
        .glass-card .bg-gray-100 .text-gray-700,
        .glass-card .bg-gray-100 .text-gray-800,
        .glass-card .bg-gray-100 .text-gray-900,
        .glass-card .bg-gray-100 .text-black,
        .glassmorphism .bg-gray-100 .text-gray-600,
        .glassmorphism .bg-gray-100 .text-gray-700,
        .glassmorphism .bg-gray-100 .text-gray-800,
        .glassmorphism .bg-gray-100 .text-gray-900,
        .glassmorphism .bg-gray-100 .text-black,
        .glass-card .bg-white .text-gray-600,
        .glassmorphism .bg-white .text-gray-900 {
            color: #1f2937 !important;
            /* Force Dark Gray for contrast on light background */
        }

        /* FIX: Protect Dark Mode text in those same inner cards */
        /* In dark mode, bg-gray-100 usually becomes white/5 or transparent, so we need white text again */
        .dark .glassmorphism .bg-gray-100 .text-gray-600,
        .dark .glassmorphism .bg-gray-100 .text-gray-700,
        .dark .glassmorphism .bg-gray-100 .text-gray-800,
        .dark .glassmorphism .bg-gray-100 .text-gray-900,
        .dark .glassmorphism .bg-gray-100 .text-black {
            color: rgba(255, 255, 255, 0.9) !important;
        }
    </style>
</head>

<body>
    <!-- Dynamic Background Glow Effect -->
    <div class="fixed top-0 left-0 w-full h-full overflow-hidden -z-10 pointer-events-none">
        <div
            class="absolute -top-1/4 -left-1/4 w-1/2 h-1/2 bg-[#00aaff]/20 rounded-full blur-[120px] animate-float opacity-70">
        </div>
        <div
            class="absolute bottom-0 right-0 w-1/3 h-1/3 bg-[#70FDFF]/10 rounded-full blur-[150px] animate-float-delay opacity-60">
        </div>
    </div>
    <!-- Login Screen -->
    <div id="loginScreen" class="min-h-screen flex items-center justify-center px-4">
        <div class="glass-card p-8 rounded-xl w-full max-w-sm">
            <div class="text-center mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">Admin Panel</h1>
                <p class="text-gray-400 text-base">Extoll.Co Project Management</p>
            </div>
            <form id="loginForm" class="space-y-6">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Username</label>
                    <input type="text" id="username" class="form-input text-base py-3 px-4" placeholder="Enter username"
                        required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Password</label>
                    <input type="password" id="password" class="form-input text-base py-3 px-4"
                        placeholder="Enter password" required>
                </div>
                <button type="submit" class="btn-primary w-full text-base py-3 min-h-[48px]">Login</button>
            </form>
        </div>
    </div>
    <!-- Admin Dashboard -->
    <div id="adminDashboard" class="hidden min-h-screen">
        <!-- Header -->
        <header class="bg-black/50 backdrop-blur-md border-b border-gray-800">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center py-8">
                    <h1 class="text-3xl font-bold text-white">Extoll.Co Admin</h1>
                    <button id="logoutBtn" class="btn-secondary">Logout</button>
                </div>
            </div>
        </header>
        <!-- Navigation Tabs -->
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="border-b border-gray-800">
                <nav class="flex space-x-8">
                    <button class="tab-button active" data-tab="projects">Projects</button>
                    <button class="tab-button" data-tab="assets">Website Assets</button>
                </nav>
            </div>
        </div>
        <!-- Projects Tab -->
        <div id="projectsTab" class="tab-content max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <h2 class="text-4xl font-bold text-white mb-12">Project Management</h2>
            <div class="glass-card p-10 rounded-xl space-y-8">
                <!-- Add New Project Button -->
                <div class="border-b border-gray-700 pb-8">
                    <div class="flex justify-between items-center mb-6">
                        <div>
                            <h3 class="text-2xl font-bold text-white mb-2">Project Management</h3>
                            <p class="text-gray-400">Create and manage your portfolio projects</p>
                        </div>
                        <a href="project-manager.html?id=new">
                            <button class="btn-primary flex items-center gap-3">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                        d="M12 4v16m8-8H4"></path>
                                </svg>
                                New Project
                            </button>
                        </a>
                    </div>
                </div>
                <!-- Existing Projects -->
                <div>
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Existing Projects</h3>
                        <div class="flex gap-4">
                            <button class="btn-secondary" onclick="syncProjects()">üîÑ Sync Projects</button>
                            <select id="filterCategory" class="form-input" style="width: auto; min-width: 150px;">
                                <option value="">All Categories</option>
                                <option value="graphics">Graphics Design</option>
                                <option value="product">Product Design</option>
                                <option value="ui">UI/UX Design</option>
                                <option value="animation">2D Animation</option>
                                <option value="video">Video Editing</option>
                            </select>
                        </div>
                    </div>
                    <div id="projectsList" class="space-y-4">
                        <p class="text-gray-400">No projects found. Create your first project above.</p>
                    </div>
                </div>
            </div>
        </div>
        <!-- Assets Tab -->
        <div id="assetsTab" class="tab-content hidden max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <h2 class="text-4xl font-bold text-white mb-12">Website Assets</h2>
            <div class="glass-card p-10 rounded-xl space-y-8">
                <!-- Logo and Banner Upload Section Removed -->
                <!-- Website Content Settings -->
                <div class="border-t border-gray-700 pt-8">
                    <h3 class="text-2xl font-bold text-white mb-6">Website Content</h3>
                    <!-- Main Hero Section -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-white mb-4">Hero Section</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Main Title</label>
                                <input type="text" id="heroTitle" class="form-input"
                                    placeholder="Crafting Digital Experiences That Stand Out">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Subtitle</label>
                                <input type="text" id="heroSubtitle" class="form-input"
                                    placeholder="Where ideas meet execution.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Description</label>
                                <textarea id="heroDescription" class="form-textarea" rows="3"
                                    placeholder="Extoll.Co is our space on the internet‚Äîa private hub where we showcase what we build, design, and create..."></textarea>
                            </div>
                        </div>
                    </div>
                    <!-- About Section -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-4">
                            <h4 class="text-lg font-semibold text-white">About Section</h4>
                            <div
                                class="text-xs text-blue-400 bg-blue-600/10 px-3 py-1 rounded-full border border-blue-600/30">
                                üìÑ Updates about.html page
                            </div>
                        </div>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">About Title</label>
                                <input type="text" id="aboutTitle" class="form-input" placeholder="About Extoll">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">About Tagline</label>
                                <input type="text" id="aboutTagline" class="form-input"
                                    placeholder="Execution-first freelance collective. Powered by Startup Ops.">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">About Description</label>
                                <textarea id="aboutDescription" class="form-textarea" rows="4"
                                    placeholder="Extoll is a curated freelance collective built by creators and operators who believe that execution matters more than promises..."></textarea>
                                <p class="text-xs text-gray-400 mt-1">üí° This content appears on the dedicated About
                                    page (about.html)</p>
                            </div>
                        </div>
                    </div>
                    <!-- Services Section -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-white mb-4">Services Section</h4>
                        <div class="grid grid-cols-1 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Services Title</label>
                                <input type="text" id="servicesTitle" class="form-input" placeholder="Services">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Services Description</label>
                                <input type="text" id="servicesDescription" class="form-input"
                                    placeholder="Professional design and creative services tailored to bring your vision to life">
                            </div>
                        </div>
                    </div>
                    <!-- Contact Information -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-white mb-4">Contact Information</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Contact Title</label>
                                <input type="text" id="contactTitle" class="form-input"
                                    placeholder="Or reach me directly">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                                <input type="tel" id="contactPhone" class="form-input" placeholder="+91 9316158312">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">WhatsApp Number</label>
                                <input type="tel" id="whatsappNumber" class="form-input" placeholder="+91 9316158312">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                <input type="email" id="contactEmail" class="form-input"
                                    placeholder="extoll.co.in@gmail.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Instagram Handle</label>
                                <input type="text" id="instagramHandle" class="form-input" placeholder="@ExtollCo">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Instagram URL</label>
                                <input type="url" id="instagramUrl" class="form-input"
                                    placeholder="https://instagram.com/extollco">
                            </div>
                        </div>
                    </div>
                    <!-- Portfolio Section -->
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-white mb-4">Portfolio Section</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Portfolio Title</label>
                                <input type="text" id="portfolioTitle" class="form-input" placeholder="Portfolio">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-300 mb-2">Portfolio
                                    Description</label>
                                <input type="text" id="portfolioDescription" class="form-input"
                                    placeholder="Showcase of our creative work and professional projects across various design disciplines.">
                            </div>
                        </div>
                    </div>
                    <button class="btn-primary mt-6" onclick="saveWebsiteContent()" id="saveContentBtn">Save All
                        Content</button>
                </div>
                <!-- Team Management -->
                <div class="border-t border-gray-700 pt-8">
                    <div class="flex justify-between items-center mb-6">
                        <h3 class="text-2xl font-bold text-white">Team & Capabilities</h3>
                        <button class="btn-secondary" onclick="addTeamMember()">+ Add Member</button>
                    </div>
                    <!-- Team Section Title -->
                    <div class="mb-6">
                        <label class="block text-sm font-medium text-gray-300 mb-2">Section Title</label>
                        <input type="text" id="teamSectionTitle" class="form-input"
                            placeholder="Our Team & Capabilities">
                    </div>
                    <!-- Dynamic Team Members Container -->
                    <div id="teamMembersContainer" class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <!-- Team members will be dynamically added here -->
                    </div>
                    <button class="btn-primary mt-6" onclick="saveTeamInfo()" id="saveTeamBtn">Save Team
                        Information</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Notification -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <script src="supabase-config.js"></script>
    <script>
        // Configuration is now loaded from supabase-config.js
        let currentUser = null;
        let adminSupabase = null;
        let selectedFile = null;
        let selectedThumbnail = null;
        let projects = [];
        let currentProject = null;
        let galleryFiles = [];
        let selectedFiles = [];
        let websiteSettings = {};
        let socialLinks = {};
        // Notification function
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            if (notification && notificationText) {
                notificationText.textContent = message;
                notification.className = 'notification ' + type;
                notification.classList.add('show');
                setTimeout(function () {
                    notification.classList.remove('show');
                }, 3000);
            }
        }
        // Login handler
        async function handleLogin(e) {
            e.preventDefault();
            console.log('üîç Login attempt started');
            const usernameInput = document.getElementById('username');
            const passwordInput = document.getElementById('password');
            if (!usernameInput || !passwordInput) {
                console.error('‚ùå Input elements not found');
                showNotification('Form elements not found', 'error');
                return;
            }
            const username = usernameInput.value.trim();
            const password = passwordInput.value.trim();
            console.log('Username:', username);
            console.log('Password length:', password.length);
            // Initialize Supabase if not already done
            if (!adminSupabase) {
                console.log('üîß Initializing Supabase for authentication...');
                const initResult = initializeSupabase();
                if (initResult) {
                    adminSupabase = configSupabase;
                } else {
                    showNotification('Failed to initialize authentication system', 'error');
                    return;
                }
            }
            try {
                // Try Supabase Authentication first
                console.log('üîç Attempting Supabase authentication...');
                const { data, error } = await adminSupabase.auth.signInWithPassword({
                    email: username,
                    password: password
                });
                if (error) throw error;
                if (data.user) {
                    console.log('‚úÖ Login successful via Supabase Authentication');
                    currentUser = {
                        email: data.user.email,
                        id: data.user.id,
                        role: data.user.user_metadata?.role || 'admin'
                    };
                    showDashboard();
                    showNotification('Login successful!', 'success');
                    loadProjects();
                    return;
                }
            } catch (supabaseError) {
                console.log('‚ö†Ô∏è Supabase authentication failed:', supabaseError.message);
                // Fallback to config credentials if Supabase auth fails
                if ((username === 'admin' || username === SUPABASE_CONFIG.adminEmail) &&
                    (password === 'extoll2024' || password === SUPABASE_CONFIG.adminPassword)) {
                    console.log('‚úÖ Login successful via config credentials');
                    currentUser = { email: username, id: 'admin', role: 'admin' };
                    showDashboard();
                    showNotification('Login successful!', 'success');
                    loadProjects();
                    // Try to authenticate with Supabase for metadata access
                    trySupabaseAuth();
                    return;
                }
                // Show appropriate error message
                if (supabaseError.message.includes('Invalid login credentials')) {
                    showNotification('Invalid credentials. Add users in Supabase Authentication ‚Üí Users', 'error');
                } else if (supabaseError.message.includes('Email not confirmed')) {
                    showNotification('Email not confirmed. Check user settings in Supabase Dashboard', 'error');
                } else {
                    showNotification('Login failed: ' + supabaseError.message, 'error');
                }
            }
        }
        // Remove the separate tryDirectSupabaseAuth function as it's now integrated above
        // Try Supabase authentication for metadata bucket access
        async function trySupabaseAuth() {
            try {
                console.log('üîé Attempting Supabase authentication for metadata access...');
                // Ensure we're using the same client as the config functions
                if (!configSupabase) {
                    console.log('‚öôÔ∏è Initializing shared Supabase client...');
                    const initResult = initializeSupabase();
                    if (!initResult) {
                        throw new Error('Failed to initialize Supabase client');
                    }
                    adminSupabase = configSupabase; // Sync the clients
                }
                // Use the signInAdmin function from config
                const authResult = await signInAdmin();
                if (authResult.success) {
                    console.log('‚úÖ Supabase authentication successful - metadata bucket access enabled');
                    // Test portfolio bucket access
                    const bucketTest = await testPortfolioBucketAccess();
                    if (bucketTest.success) {
                        showNotification('Metadata bucket access enabled', 'success');
                    } else {
                        showNotification('Authentication successful but bucket access failed', 'warning');
                        console.error('üö´ Bucket access issue:', bucketTest.error);
                    }
                } else {
                    console.log('‚ùå Supabase authentication failed:', authResult.error);
                    showNotification('Authentication failed - using local storage only', 'warning');
                    console.log('üìÇ Note: Projects will be stored locally only');
                    // Show specific error guidance
                    if (authResult.error.includes('Invalid login credentials')) {
                        console.error('üí° Create admin user: Supabase Dashboard ‚Üí Authentication ‚Üí Users ‚Üí Add user');
                        console.error('   Email: admin@extoll.co, Password: extoll2024');
                    }
                }
            } catch (error) {
                console.error('‚ùå Supabase auth error:', error);
                showNotification('Authentication error - using local storage only', 'warning');
            }
        }
        // Show dashboard
        function showDashboard() {
            console.log('üéØ Showing dashboard...');
            const loginScreen = document.getElementById('loginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            if (loginScreen && adminDashboard) {
                loginScreen.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                console.log('‚úÖ Dashboard shown successfully');
            } else {
                console.error('‚ùå Dashboard elements not found');
            }
        }
        // Logout handler
        function handleLogout() {
            console.log('üö™ Logging out');
            currentUser = null;
            showLogin();
            showNotification('Logged out', 'success');
        }
        // Check authentication state on page load
        async function checkAuthenticationState() {
            console.log('üîç Checking authentication state...');
            try {
                if (!adminSupabase) {
                    console.log('‚ùå Supabase not initialized, showing login');
                    showLogin();
                    return;
                }
                // Check if user is already authenticated
                const { data: { user }, error } = await adminSupabase.auth.getUser();
                if (error) {
                    console.log('‚ùå Auth check error:', error.message);
                    showLogin();
                    return;
                }
                if (user) {
                    console.log('‚úÖ User already authenticated:', user.email);
                    currentUser = {
                        email: user.email,
                        authenticated: true,
                        source: 'supabase'
                    };
                    showDashboard();
                    showNotification('Welcome back, ' + user.email, 'success');
                } else {
                    console.log('‚ÑπÔ∏è No authenticated user found, showing login');
                    showLogin();
                }
            } catch (error) {
                console.error('‚ùå Authentication check failed:', error);
                showLogin();
            }
        }
        // Show dashboard
        function showDashboard() {
            const loginScreen = document.getElementById('loginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            if (loginScreen && adminDashboard) {
                loginScreen.classList.add('hidden');
                adminDashboard.classList.remove('hidden');
                // Load initial data
                loadProjects();
                loadWebsiteContent();
                loadTeamInfo();
                console.log('‚úÖ Dashboard shown');
            }
        }
        // Show login
        function showLogin() {
            const loginScreen = document.getElementById('loginScreen');
            const adminDashboard = document.getElementById('adminDashboard');
            if (loginScreen && adminDashboard) {
                loginScreen.classList.remove('hidden');
                adminDashboard.classList.add('hidden');
            }
        }
        // Tab switching
        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.tab-button').forEach(function (button) {
                button.classList.remove('active');
            });
            const activeTab = document.querySelector('[data-tab="' + tabName + '"]');
            if (activeTab) {
                activeTab.classList.add('active');
            }
            // Update tab content
            document.querySelectorAll('.tab-content').forEach(function (content) {
                content.classList.add('hidden');
            });
            const targetTab = {
                'projects': 'projectsTab',
                'assets': 'assetsTab'
            };
            const targetElement = document.getElementById(targetTab[tabName]);
            if (targetElement) {
                targetElement.classList.remove('hidden');
            }
            // Load data when switching to specific tabs
            if (tabName === 'projects') {
                loadProjects();
            } else if (tabName === 'assets') {
                loadWebsiteAssets();
            }
        }
        // File upload functions
        function handleFileSelect(file) {
            selectedFile = file;
            const preview = document.getElementById('testPreview');
            if (preview) {
                preview.innerHTML = '<div class="bg-gray-800 p-4 rounded-lg">' +
                    '<p class="text-white"><strong>Selected:</strong> ' + file.name + '</p>' +
                    '<p class="text-gray-400"><strong>Size:</strong> ' + (file.size / 1024 / 1024).toFixed(2) + ' MB</p>' +
                    '<p class="text-gray-400"><strong>Type:</strong> ' + file.type + '</p>' +
                    '</div>';
            }
            logMessage('üìÑ File selected: ' + file.name + ' (' + (file.size / 1024 / 1024).toFixed(2) + ' MB)');
        }
        function logMessage(message) {
            const log = document.getElementById('uploadLog');
            if (log) {
                const timestamp = new Date().toLocaleTimeString();
                log.innerHTML += '[' + timestamp + '] ' + message + '\n';
                log.scrollTop = log.scrollHeight;
            }
            console.log(message);
        }
        // Test upload function
        function testUpload() {
            if (!selectedFile) {
                showNotification('Please select a file first', 'error');
                return;
            }
            if (!adminSupabase) {
                showNotification('Supabase not initialized', 'error');
                return;
            }
            logMessage('üöÄ Starting upload test...');
            // Test upload with project folder structure
            const timestamp = Date.now();
            const extension = selectedFile.name.split('.').pop();
            const fileName = 'test-' + timestamp + '.' + extension;
            const filePath = 'test-project/' + fileName; // Project folder structure
            logMessage('üì§ Uploading to: ' + filePath);
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .upload(filePath, selectedFile, {
                    cacheControl: '0',
                    upsert: true
                })
                .then(function (result) {
                    if (result.error) {
                        throw result.error;
                    }
                    logMessage('‚úÖ File uploaded successfully: ' + result.data.path);
                    // Get public URL
                    const publicUrlResult = adminSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .getPublicUrl(filePath);
                    const publicUrl = publicUrlResult.data.publicUrl;
                    logMessage('üîó Public URL: ' + publicUrl);
                    showNotification('Upload successful!', 'success');
                })
                .catch(function (error) {
                    logMessage('‚ùå Upload failed: ' + error.message);
                    showNotification('Upload failed: ' + error.message, 'error');
                    console.error('Upload error:', error);
                });
        }
        // Project functions
        // Generate a random UUID for project ID
        function generateUUID() {
            return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
                const r = Math.random() * 16 | 0;
                const v = c === 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
        }

        // Generate a short random suffix for project key uniqueness
        function generateShortId() {
            return Math.random().toString(36).substring(2, 8);
        }

        function generateProjectKey(title) {
            const baseKey = title.toLowerCase()
                .replace(/[^a-z0-9\s-]/g, '')
                .replace(/\s+/g, '-')
                .replace(/-+/g, '-')
                .trim();
            // Add short random suffix for uniqueness
            return baseKey + '-' + generateShortId();
        }
        function handleThumbnailSelect(file) {
            selectedThumbnail = file;
            const preview = document.getElementById('thumbnailPreview');
            if (file.type.startsWith('image/') && preview) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    preview.innerHTML = '<div style="display: inline-block; position: relative;">' +
                        '<img src="' + e.target.result + '" alt="Thumbnail preview" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px;">' +
                        '<button onclick="removeThumbnail()" style="position: absolute; top: -8px; right: -8px; background: #dc2626; color: white; border: none; border-radius: 50%; width: 24px; height: 24px; cursor: pointer;">√ó</button>' +
                        '</div>';
                };
                reader.readAsDataURL(file);
            }
        }
        function removeThumbnail() {
            selectedThumbnail = null;
            const preview = document.getElementById('thumbnailPreview');
            const input = document.getElementById('thumbnailInput');
            if (preview) preview.innerHTML = '';
            if (input) input.value = '';
        }
        async function handleProjectSubmit(e) {
            e.preventDefault();
            // Change button to saving state
            const submitBtn = document.getElementById('projectSubmitBtn');
            const originalText = submitBtn.textContent;
            submitBtn.textContent = 'Creating...';
            submitBtn.disabled = true;
            const title = document.getElementById('projectTitle').value;
            const key = document.getElementById('projectKey').value;
            const description = document.getElementById('projectDescription').value;
            const category = document.getElementById('projectCategory').value;
            const tags = document.getElementById('projectTags').value;
            if (!selectedThumbnail) {
                showNotification('Please select a thumbnail image', 'error');
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                return;
            }
            if (!adminSupabase) {
                showNotification('Supabase not initialized', 'error');
                // Reset button
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                return;
            }
            try {
                // Upload thumbnail with project folder structure
                const thumbnailFileName = 'thumb-' + Date.now() + '.' + selectedThumbnail.name.split('.').pop();
                const thumbnailPath = key + '/' + thumbnailFileName;
                const uploadResult = await adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(thumbnailPath, selectedThumbnail, {
                        cacheControl: '0',
                        upsert: true
                    });
                if (uploadResult.error) {
                    throw uploadResult.error;
                }
                const publicUrlResult = adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .getPublicUrl(thumbnailPath);
                const thumbnailUrl = publicUrlResult.data.publicUrl;
                // Create project object
                const projectData = {
                    title: title,
                    key: key,
                    description: description,
                    category: category,
                    count: 1, // Default count, will be updated when files are uploaded
                    thumbnail_url: thumbnailUrl
                };
                // Store in Supabase metadata bucket
                try {
                    const result = await createProject(projectData);
                    if (result.success) {
                        console.log('‚úÖ Project stored in metadata bucket');
                        // Also store in localStorage as backup
                        const existingProjects = JSON.parse(localStorage.getItem('projects') || '[]');
                        existingProjects.push(result.data);
                        localStorage.setItem('projects', JSON.stringify(existingProjects));
                        showNotification('Project created successfully!', 'success');
                    } else {
                        console.log('‚ùå Metadata bucket failed, storing in localStorage only:', result.error);
                        // Store in localStorage as fallback
                        const existingProjects = JSON.parse(localStorage.getItem('projects') || '[]');
                        projectData.id = generateUUID();
                        projectData.created_at = new Date().toISOString();
                        existingProjects.push(projectData);
                        localStorage.setItem('projects', JSON.stringify(existingProjects));
                        showNotification('Project created (local storage only)', 'warning');
                    }
                } catch (error) {
                    console.error('‚ùå Error creating project:', error);
                    // Store in localStorage as fallback
                    const existingProjects = JSON.parse(localStorage.getItem('projects') || '[]');
                    projectData.id = generateUUID();
                    projectData.created_at = new Date().toISOString();
                    existingProjects.push(projectData);
                    localStorage.setItem('projects', JSON.stringify(existingProjects));
                    showNotification('Project created (local storage only)', 'warning');
                }
                // Reset form
                document.getElementById('projectForm').reset();
                removeThumbnail();
                // Refresh projects list
                loadProjects();
                // Change button to success state
                submitBtn.textContent = '‚úÖ Created';
                submitBtn.disabled = false;
                // Reset button after 3 seconds
                setTimeout(function () {
                    submitBtn.textContent = 'Create Project';
                }, 3000);
                console.log('Project created:', projectData);
            } catch (error) {
                showNotification('Project creation failed: ' + error.message, 'error');
                console.error('Project creation error:', error);
                // Reset button on error
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
            }
        }
        async function loadProjects() {
            try {
                // Debug: Log what we're trying to load
                console.log('üîÑ Loading projects from portfolio bucket...');
                // Use getProjectsPublic for consistency with portfolio page
                const result = await getProjectsPublic();
                if (result.success && result.data.length > 0) {
                    projects = result.data;
                    console.log('‚úÖ Loaded projects from bucket:', projects.length);
                    console.log('üìù Project titles:', projects.map(p => p.title));
                } else {
                    console.log('üìÑ No projects found in bucket');
                    projects = [];
                }
                displayProjects();
            } catch (error) {
                console.error('‚ùå Error loading projects:', error);
                projects = [];
                displayProjects();
            }
        }
        function displayProjects() {
            const projectsList = document.getElementById('projectsList');
            const categoryFilter = document.getElementById('filterCategory').value;
            // Debug: Log all projects and filter value
            console.log('All projects:', projects);
            console.log('Category filter value:', categoryFilter);
            let filteredProjects = projects;
            if (categoryFilter) {
                filteredProjects = filteredProjects.filter(p => p.category === categoryFilter);
                console.log('Filtered projects:', filteredProjects);
            }
            if (filteredProjects.length === 0) {
                projectsList.innerHTML = '<p class="text-gray-400">No projects found matching the current filters.</p>';
                return;
            }
            projectsList.innerHTML = filteredProjects.map(project => `
        <div class="bg-gray-800/50 p-6 rounded-lg cursor-pointer hover:bg-gray-800/70 transition-all duration-300 hover:scale-105 hover:shadow-lg" onclick="openProjectManager('${project.key}')">
            <div class="flex items-start justify-between">
                <div class="flex items-start gap-4 flex-1">
                    ${project.thumbnail_url ? `<img src="${project.thumbnail_url}" alt="${project.title}" class="w-20 h-20 object-cover rounded-lg">` : ''}
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-2">
                            <h4 class="text-xl font-bold text-white">${project.title}</h4>
                            <span class="px-2 py-1 text-xs rounded-full bg-blue-600/20 text-blue-400">${project.category}</span>
                        </div>
                        <p class="text-gray-400 mb-2">${project.description}</p>
                        <div class="flex flex-wrap gap-2 mb-2">
                            ${project.tags ? project.tags.map(tag => `<span class="px-2 py-1 text-xs bg-gray-700 text-gray-300 rounded">${tag}</span>`).join('') : ''}
                        </div>
                        <div class="text-sm text-gray-500">
                            <p>Key: ${project.key}</p>
                            <p>Created: ${new Date(project.created_at).toLocaleDateString()}</p>
                        </div>
                    </div>
                </div>
                <div class="flex flex-col gap-2 ml-4">
                    <button class="bg-red-600 hover:bg-red-700 text-white py-2 px-4 rounded-lg text-sm transition-colors" onclick="event.stopPropagation(); deleteProject('${project.key}')">Delete</button>
                </div>
            </div>
        </div>
    `).join('');
        }
        function refreshProjects() {
            loadProjects();
            showNotification('Projects refreshed', 'success');
        }
        async function syncProjects() {
            try {
                showNotification('Syncing projects from portfolio bucket...', 'success');
                // Get all project folders from portfolio bucket
                const { data: folders, error: listError } = await configSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .list('', { limit: 100 });
                if (listError) {
                    throw new Error('Failed to list portfolio folders: ' + listError.message);
                }
                // Filter out website-assets and get project folders
                const projectFolders = folders.filter(folder =>
                    folder.name !== SUPABASE_CONFIG.websiteAssets.folder &&
                    folder.name !== '.emptyFolderPlaceholder'
                );
                console.log('üìÇ Found project folders:', projectFolders.map(f => f.name));
                let syncedCount = 0;
                let updatedCount = 0;
                for (const folder of projectFolders) {
                    try {
                        // Download project metadata from project folder
                        const metadataPath = `${folder.name}/${SUPABASE_CONFIG.projectStructure.metadata}`;
                        const { data: fileData, error: downloadError } = await configSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .download(metadataPath);
                        if (downloadError) {
                            console.warn('√¢≈°¬†√Ø¬∏¬è No metadata found for:', folder.name);
                            continue;
                        }
                        const text = await fileData.text();
                        const project = JSON.parse(text);
                        console.log('üìÑ Processing project:', project.title, 'Key:', project.key);
                        // Check if project exists in database
                        const { data: existingProject, error: selectError } = await configSupabase
                            .from('projects')
                            .select('*')
                            .eq('key', project.key)
                            .single();
                        if (selectError && selectError.code !== 'PGRST116') {
                            console.warn('√¢≈°¬†√Ø¬∏¬è Error checking existing project:', selectError);
                            continue;
                        }
                        if (existingProject) {
                            // Update existing project with latest metadata
                            const { error: updateError } = await configSupabase
                                .from('projects')
                                .update({
                                    title: project.title,
                                    category: project.category,
                                    description: project.description,
                                    count: project.count || 1,
                                    thumbnail_url: project.thumbnail_url || null
                                })
                                .eq('key', project.key);
                            if (!updateError) {
                                console.log('√¢≈ì‚Ä¶ Updated project:', project.title);
                                updatedCount++;
                            } else {
                                console.warn('√¢≈°¬†√Ø¬∏¬è Failed to update project:', updateError);
                            }
                        } else {
                            // Insert new project
                            const { error: insertError } = await configSupabase
                                .from('projects')
                                .insert([{
                                    title: project.title,
                                    key: project.key,
                                    category: project.category,
                                    description: project.description,
                                    count: project.count || 1,
                                    thumbnail_url: project.thumbnail_url || null
                                }]);
                            if (!insertError) {
                                console.log('√¢≈ì‚Ä¶ Inserted new project:', project.title);
                                syncedCount++;
                            } else {
                                console.warn('√¢≈°¬†√Ø¬∏¬è Failed to insert project:', insertError);
                            }
                        }
                    } catch (parseError) {
                        console.warn('√¢≈°¬†√Ø¬∏¬è Failed to process project folder:', folder.name, parseError);
                    }
                }
                const totalChanges = syncedCount + updatedCount;
                if (totalChanges > 0) {
                    showNotification(`Sync complete! ${syncedCount} new, ${updatedCount} updated projects`, 'success');
                } else {
                    showNotification('All projects are already in sync', 'success');
                }
                // Refresh the display
                loadProjects();
            } catch (error) {
                console.error('√¢¬ù≈í Sync error:', error);
                showNotification('Sync failed: ' + error.message, 'error');
            }
        }
        function openProjectManager(key) {
            // Redirect to project manager in same tab
            window.location.href = `project-manager.html?key=${key}`;
        }
        function editProject(key) {
            const project = projects.find(p => p.key === key);
            if (!project) return;
            // Fill form with project data
            document.getElementById('projectTitle').value = project.title;
            document.getElementById('projectKey').value = project.key;
            document.getElementById('projectDescription').value = project.description;
            document.getElementById('projectCategory').value = project.category;
            document.getElementById('projectTags').value = project.tags ? project.tags.join(', ') : '';
            // Show thumbnail if exists
            if (project.thumbnail_url) {
                const preview = document.getElementById('thumbnailPreview');
                preview.innerHTML = `
            <div style="display: inline-block; position: relative;">
                <img src="${project.thumbnail_url}" alt="Current thumbnail" style="width: 150px; height: 150px; object-fit: cover; border-radius: 8px;">
                <p class="text-xs text-gray-400 mt-2">Current thumbnail</p>
            </div>
        `;
            }
            // Load project files for image management
            loadProjectFiles(project.key);
            // Change form button to update
            const submitBtn = document.querySelector('#projectForm button[type="submit"]');
            submitBtn.textContent = 'Update Project';
            const projectKey = project.key; // Store key for closure
            submitBtn.onclick = function (e) {
                e.preventDefault();
                updateProject(projectKey);
            };
            showNotification('Project loaded for editing', 'success');
        }
        async function updateProject(key) {
            const project = projects.find(p => p.key === key);
            if (!project) return;
            // Update project data
            project.title = document.getElementById('projectTitle').value;
            project.description = document.getElementById('projectDescription').value;
            project.category = document.getElementById('projectCategory').value;
            project.tags = document.getElementById('projectTags').value.split(',').map(tag => tag.trim()).filter(tag => tag);
            project.updated_at = new Date().toISOString();
            try {
                // Update in Supabase metadata bucket first using the config function
                console.log('üîÑ Updating project in metadata bucket:', project.key);
                // Use the updateProject function from supabase-config.js
                if (typeof window.updateProject === 'function') {
                    const result = await window.updateProject(project.key, project);
                    if (result.success) {
                        console.log('√¢≈ì‚Ä¶ Project updated in metadata bucket');
                        showNotification('Project updated successfully!', 'success');
                    } else {
                        console.log('√¢¬ù≈í Metadata bucket update failed:', result.error);
                        showNotification('Project updated locally (cloud sync failed)', 'warning');
                    }
                } else {
                    // Fallback: manually update portfolio bucket
                    if (adminSupabase && SUPABASE_CONFIG.bucket) {
                        const metadataPath = `${project.key}/${SUPABASE_CONFIG.projectStructure.metadata}`;
                        const uploadResult = await adminSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .upload(metadataPath, JSON.stringify(project, null, 2), {
                                contentType: 'application/json',
                                upsert: true
                            });
                        if (uploadResult.error) {
                            console.error('√¢¬ù≈í Metadata update failed:', uploadResult.error);
                            showNotification('Project updated locally (cloud sync failed)', 'warning');
                        } else {
                            console.log('√¢≈ì‚Ä¶ Project metadata updated successfully');
                            showNotification('Project updated successfully!', 'success');
                        }
                    } else {
                        showNotification('Project updated locally only', 'warning');
                    }
                }
            } catch (error) {
                console.error('√¢¬ù≈í Error updating project metadata:', error);
                showNotification('Project updated locally (cloud sync failed)', 'warning');
            }
            // Update in localStorage as backup
            localStorage.setItem('projects', JSON.stringify(projects));
            // Reset form
            document.getElementById('projectForm').reset();
            removeThumbnail();
            // Reset button
            const submitBtn = document.querySelector('#projectForm button[type="submit"]');
            submitBtn.textContent = 'Create Project';
            submitBtn.onclick = null;
            // Clear current editing project
            currentEditingProject = null;
            // Refresh projects list
            loadProjects();
        }
        function duplicateProject(key) {
            const project = projects.find(p => p.key === key);
            if (!project) return;
            const newProject = {
                ...project,
                id: generateUUID(),
                title: project.title + ' (Copy)',
                key: project.key + '-copy',
                created_at: new Date().toISOString()
            };
            projects.push(newProject);
            localStorage.setItem('projects', JSON.stringify(projects));
            showNotification('Project duplicated successfully!', 'success');
            loadProjects();
        }
        async function deleteProject(key) {
            if (!confirm('Are you sure you want to delete this project? This will also delete all associated files.')) return;
            const projectIndex = projects.findIndex(p => p.key === key);
            if (projectIndex === -1) {
                showNotification('Project not found', 'error');
                return;
            }
            const project = projects[projectIndex];
            console.log('Deleting project:', project.title, '(Key:', key, ')');
            try {
                // Delete from metadata bucket using the config function
                if (project.key) {
                    console.log('üóëÔ∏è¬è Deleting from metadata bucket...');
                    const metadataResult = await deleteProjectMetadata(project.key);
                    if (metadataResult.success) {
                        console.log('√¢≈ì‚Ä¶ Project metadata deleted from bucket');
                    } else {
                        console.error('√¢¬ù≈í Failed to delete metadata:', metadataResult.error);
                    }
                }
                // Delete project files from public storage bucket
                if (adminSupabase && project.key) {
                    console.log('üóëÔ∏è¬è Deleting project files and folder...');
                    const listResult = await adminSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .list(project.key);
                    if (listResult.error) {
                        console.error('√¢¬ù≈í Error listing project files:', listResult.error);
                    } else if (listResult.data && listResult.data.length > 0) {
                        const filesToDelete = listResult.data.map(file => project.key + '/' + file.name);
                        console.log('üóëÔ∏è¬è Deleting', filesToDelete.length, 'project files:', filesToDelete);
                        const deleteResult = await adminSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .remove(filesToDelete);
                        if (deleteResult.error) {
                            console.error('√¢¬ù≈í Error deleting project files:', deleteResult.error);
                            showNotification('Error deleting some project files', 'warning');
                        } else {
                            console.log('√¢≈ì‚Ä¶ Project files deleted from storage');
                            // Verify deletion by listing again
                            const verifyResult = await adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .list(project.key);
                            if (verifyResult.data && verifyResult.data.length > 0) {
                                console.warn('√¢≈°¬†√Ø¬∏¬è Some files may still remain:', verifyResult.data.length);
                                // Try to delete remaining files
                                const remainingFiles = verifyResult.data.map(file => project.key + '/' + file.name);
                                console.log('üóëÔ∏è¬è Attempting to delete remaining files:', remainingFiles);
                                const finalDeleteResult = await adminSupabase.storage
                                    .from(SUPABASE_CONFIG.bucket)
                                    .remove(remainingFiles);
                                if (finalDeleteResult.error) {
                                    console.error('√¢¬ù≈í Error deleting remaining files:', finalDeleteResult.error);
                                } else {
                                    console.log('√¢≈ì‚Ä¶ Remaining files deleted');
                                }
                            } else {
                                console.log('√¢≈ì‚Ä¶ Project folder is now empty');
                            }
                        }
                    } else {
                        console.log('√∞≈∏‚Äú¬Å No project files found to delete');
                    }
                    // Additional cleanup: Try to delete any hidden or system files
                    try {
                        console.log('√∞≈∏¬ß¬π Performing additional cleanup for folder:', project.key);
                        // List with different parameters to catch any remaining files
                        const deepListResult = await adminSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .list(project.key, {
                                limit: 1000,
                                offset: 0
                            });
                        if (deepListResult.data && deepListResult.data.length > 0) {
                            console.log('√∞≈∏‚Äù¬ç Found additional files during deep scan:', deepListResult.data.length);
                            const additionalFiles = deepListResult.data.map(file => project.key + '/' + file.name);
                            const cleanupResult = await adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .remove(additionalFiles);
                            if (cleanupResult.error) {
                                console.error('√¢¬ù≈í Error during additional cleanup:', cleanupResult.error);
                            } else {
                                console.log('√¢≈ì‚Ä¶ Additional cleanup completed');
                            }
                        }
                    } catch (cleanupError) {
                        console.warn('√¢≈°¬†√Ø¬∏¬è Additional cleanup failed:', cleanupError.message);
                    }
                }
                // Remove from local projects array and localStorage
                projects.splice(projectIndex, 1);
                localStorage.setItem('projects', JSON.stringify(projects));
                // Delete from Supabase database table
                if (adminSupabase) {
                    console.log('üóëÔ∏è¬è Deleting from database table...');
                    const { error: dbDeleteError } = await adminSupabase
                        .from('projects')
                        .delete()
                        .eq('key', project.key);
                    if (dbDeleteError) {
                        console.error('√¢¬ù≈í Failed to delete from database:', dbDeleteError);
                    } else {
                        console.log('√¢≈ì‚Ä¶ Project deleted from database');
                    }
                }
                console.log('√¢≈ì‚Ä¶ Project removed from local storage');
                showNotification('Project deleted successfully!', 'success');
                loadProjects();
            } catch (error) {
                console.error('√¢¬ù≈í Error during project deletion:', error);
                // Still remove from local storage even if cloud deletion fails
                projects.splice(projectIndex, 1);
                localStorage.setItem('projects', JSON.stringify(projects));
                // Try to delete from database even if other operations failed
                if (adminSupabase && project.key) {
                    try {
                        const { error: dbDeleteError } = await adminSupabase
                            .from('projects')
                            .delete()
                            .eq('key', project.key);
                        if (dbDeleteError) {
                            console.error('√¢¬ù≈í Failed to delete from database:', dbDeleteError);
                        } else {
                            console.log('√¢≈ì‚Ä¶ Project deleted from database');
                        }
                    } catch (dbError) {
                        console.error('√¢¬ù≈í Database deletion error:', dbError);
                    }
                }
                showNotification('Project deleted locally (cloud deletion may have failed)', 'warning');
                loadProjects();
            }
        }
        function manageProjectFiles(id) {
            const project = projects.find(p => p.id === id);
            if (!project) return;
            // Load project for editing and show image management
            editProject(id);
            // Scroll to the image management section
            setTimeout(function () {
                const imageSection = document.getElementById('projectGallery');
                if (imageSection) {
                    imageSection.scrollIntoView({ behavior: 'smooth' });
                    // Load project files
                    loadProjectFiles(project.key);
                }
            }, 100);
        }
        // Refresh project files manually
        function refreshProjectFiles() {
            if (currentEditingProject && currentEditingProject.key) {
                console.log('üîÑ Manually refreshing project files for:', currentEditingProject.key);
                loadProjectFiles(currentEditingProject.key);
            } else {
                // Try to get project key from the form
                const projectKey = document.getElementById('projectKey').value;
                if (projectKey) {
                    console.log('üîÑ Refreshing files using form project key:', projectKey);
                    loadProjectFiles(projectKey);
                } else {
                    showNotification('No project selected for file refresh', 'warning');
                }
            }
        }
        // Force load project files with multiple fallback methods
        function forceLoadProjectFiles() {
            console.log('üöÄ Force loading project files...');
            // Method 1: Try currentEditingProject
            if (currentEditingProject && currentEditingProject.key) {
                console.log('√∞≈∏‚Äú¬Å Method 1: Using currentEditingProject key:', currentEditingProject.key);
                loadProjectFiles(currentEditingProject.key);
                return;
            }
            // Method 2: Try form project key
            const projectKey = document.getElementById('projectKey').value;
            if (projectKey) {
                console.log('√∞≈∏‚Äú¬Å Method 2: Using form project key:', projectKey);
                loadProjectFiles(projectKey);
                return;
            }
            // Method 3: Try to find project from projects array using form title
            const projectTitle = document.getElementById('projectTitle').value;
            if (projectTitle && projects.length > 0) {
                const foundProject = projects.find(p => p.title === projectTitle);
                if (foundProject) {
                    console.log('√∞≈∏‚Äú¬Å Method 3: Found project by title:', foundProject.key);
                    currentEditingProject = foundProject;
                    loadProjectFiles(foundProject.key);
                    return;
                }
            }
            // Method 4: Show all available projects for manual selection
            console.log('√∞≈∏‚Äú¬Å Method 4: Showing available projects for manual selection');
            if (projects.length > 0) {
                const projectKeys = projects.map(p => `${p.title} (${p.key})`).join('\n');
                const selectedKey = prompt(`No project key found. Available projects:\n\n${projectKeys}\n\nEnter project key manually:`);
                if (selectedKey) {
                    console.log('√∞≈∏‚Äú¬Å Manual project key entered:', selectedKey);
                    loadProjectFiles(selectedKey);
                    return;
                }
            }
            showNotification('Could not determine project key. Please edit a project first.', 'error');
            console.error('√¢¬ù≈í All methods failed to find project key');
        }
        // Debug function to check current state
        function debugProjectFiles() {
            console.log('√∞≈∏‚Äù¬ç DEBUG: Current project files state');
            console.log('currentEditingProject:', currentEditingProject);
            console.log('projects array:', projects);
            console.log('projectFiles array:', projectFiles);
            console.log('Form project key:', document.getElementById('projectKey')?.value);
            console.log('Form project title:', document.getElementById('projectTitle')?.value);
            console.log('adminSupabase:', !!adminSupabase);
            console.log('SUPABASE_CONFIG.bucket:', SUPABASE_CONFIG?.bucket);
            // Make this function available globally for console access
            window.debugProjectFiles = debugProjectFiles;
            window.forceLoadProjectFiles = forceLoadProjectFiles;
            window.loadProjectFiles = loadProjectFiles;
        }
        // Project Image Management Functions
        let currentEditingProject = null;
        let projectFiles = [];
        // Update project file count after uploads
        async function updateProjectFileCount(projectKey) {
            try {
                console.log('√∞≈∏‚Äù¬¢ Updating file count for project:', projectKey);
                // Get current file count from storage (excluding JSON files)
                const listResult = await adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .list(projectKey);
                if (listResult.error) {
                    console.error('√¢¬ù≈í Error getting file count:', listResult.error);
                    return;
                }
                // Filter out JSON files, thumbnails, and system files when counting
                const actualFiles = listResult.data ? listResult.data.filter(file => {
                    const fileName = file.name.toLowerCase();
                    return !fileName.endsWith('.json') &&
                        !fileName.startsWith('thumb-') &&
                        !fileName.startsWith('logo') &&
                        !fileName.startsWith('banner');
                }) : [];
                const fileCount = actualFiles.length;
                console.log('√∞≈∏‚Äú≈† Actual project file count (excluding JSON/system files):', fileCount);
                // Find and update the project in the projects array
                const projectIndex = projects.findIndex(p => p.key === projectKey);
                if (projectIndex !== -1) {
                    projects[projectIndex].count = fileCount;
                    projects[projectIndex].updated_at = new Date().toISOString();
                    // Update localStorage
                    localStorage.setItem('projects', JSON.stringify(projects));
                    // Update Supabase portfolio bucket
                    try {
                        if (adminSupabase && SUPABASE_CONFIG.bucket) {
                            const metadataPath = `${projectKey}/${SUPABASE_CONFIG.projectStructure.metadata}`;
                            const uploadResult = await adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .upload(metadataPath, JSON.stringify(projects[projectIndex], null, 2), {
                                    contentType: 'application/json',
                                    upsert: true
                                });
                            if (uploadResult.error) {
                                console.error('√¢¬ù≈í Metadata update failed:', uploadResult.error);
                            } else {
                                console.log('√¢≈ì‚Ä¶ Project count updated in metadata bucket');
                            }
                        }
                    } catch (error) {
                        console.error('√¢¬ù≈í Error updating metadata:', error);
                    }
                    // Refresh the projects display
                    displayProjects();
                    console.log('√¢≈ì‚Ä¶ Project file count updated:', fileCount);
                } else {
                    console.warn('√¢≈°¬†√Ø¬∏¬è Project not found in projects array:', projectKey);
                }
            } catch (error) {
                console.error('√¢¬ù≈í Error updating project file count:', error);
            }
        }
        function handleProjectImageUpload(files) {
            // Check if we have a project to upload to
            const projectKey = currentEditingProject ? currentEditingProject.key : document.getElementById('projectKey').value;
            if (!projectKey) {
                showNotification('Please enter a project title first to generate a project key', 'error');
                return;
            }
            if (!adminSupabase) {
                showNotification('Supabase not initialized. Please check your connection.', 'error');
                return;
            }
            console.log('üì§ Uploading images to project:', projectKey);
            const progressList = document.getElementById('projectUploadProgressList');
            const progressSection = document.getElementById('projectUploadProgress');
            progressSection.classList.remove('hidden');
            let uploadedCount = 0;
            const totalFiles = files.length;
            Array.from(files).forEach(function (file, index) {
                const fileName = 'img-' + Date.now() + '-' + index + '.' + file.name.split('.').pop();
                const filePath = projectKey + '/' + fileName;
                console.log('üì§ Uploading file:', fileName, 'to path:', filePath);
                const progressItem = document.createElement('div');
                progressItem.className = 'flex justify-between items-center p-2 bg-gray-700 rounded';
                progressItem.innerHTML = `
            <span class="text-white">${file.name}</span>
            <span class="text-gray-400">Uploading...</span>
        `;
                progressList.appendChild(progressItem);
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(filePath, file, {
                        cacheControl: '0',
                        upsert: true
                    })
                    .then(function (result) {
                        if (result.error) {
                            console.error('√¢¬ù≈í Upload failed:', result.error);
                            progressItem.innerHTML = `
                        <span class="text-white">${file.name}</span>
                        <span class="text-red-400">Failed: ${result.error.message}</span>
                    `;
                            return;
                        }
                        console.log('√¢≈ì‚Ä¶ Upload successful:', result.data.path);
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-green-400">√¢≈ì‚Äú Uploaded</span>
                `;
                        uploadedCount++;
                        // Update project count when all files are uploaded
                        if (uploadedCount === totalFiles) {
                            updateProjectFileCount(projectKey);
                        }
                        // Refresh gallery after upload if we're editing
                        if (currentEditingProject) {
                            setTimeout(function () {
                                loadProjectFiles(currentEditingProject.key);
                            }, 1000);
                        } else {
                            // For new projects, just show success
                            showNotification('Image uploaded successfully!', 'success');
                        }
                    })
                    .catch(function (error) {
                        console.error('√¢¬ù≈í Upload error:', error);
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-red-400">Error: ${error.message}</span>
                `;
                    });
            });
        }
        function handleProjectVideoUpload(files) {
            // Check if we have a project to upload to
            const projectKey = currentEditingProject ? currentEditingProject.key : document.getElementById('projectKey').value;
            if (!projectKey) {
                showNotification('Please enter a project title first to generate a project key', 'error');
                return;
            }
            if (!adminSupabase) {
                showNotification('Supabase not initialized. Please check your connection.', 'error');
                return;
            }
            console.log('üì§ Uploading videos to project:', projectKey);
            const progressList = document.getElementById('projectUploadProgressList');
            const progressSection = document.getElementById('projectUploadProgress');
            progressSection.classList.remove('hidden');
            let uploadedCount = 0;
            const totalFiles = files.length;
            Array.from(files).forEach(function (file, index) {
                const fileName = 'vid-' + Date.now() + '-' + index + '.' + file.name.split('.').pop();
                const filePath = projectKey + '/' + fileName;
                console.log('üì§ Uploading video:', fileName, 'to path:', filePath);
                const progressItem = document.createElement('div');
                progressItem.className = 'flex justify-between items-center p-2 bg-gray-700 rounded';
                progressItem.innerHTML = `
            <span class="text-white">${file.name}</span>
            <span class="text-gray-400">Uploading...</span>
        `;
                progressList.appendChild(progressItem);
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(filePath, file, {
                        cacheControl: '0',
                        upsert: true
                    })
                    .then(function (result) {
                        if (result.error) {
                            console.error('√¢¬ù≈í Video upload failed:', result.error);
                            progressItem.innerHTML = `
                        <span class="text-white">${file.name}</span>
                        <span class="text-red-400">Failed: ${result.error.message}</span>
                    `;
                            return;
                        }
                        console.log('√¢≈ì‚Ä¶ Video upload successful:', result.data.path);
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-green-400">√¢≈ì‚Äú Uploaded</span>
                `;
                        uploadedCount++;
                        // Update project count when all files are uploaded
                        if (uploadedCount === totalFiles) {
                            updateProjectFileCount(projectKey);
                        }
                        // Refresh gallery after upload if we're editing
                        if (currentEditingProject) {
                            setTimeout(function () {
                                loadProjectFiles(currentEditingProject.key);
                            }, 1000);
                        } else {
                            // For new projects, just show success
                            showNotification('Video uploaded successfully!', 'success');
                        }
                    })
                    .catch(function (error) {
                        console.error('√¢¬ù≈í Video upload error:', error);
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-red-400">Error: ${error.message}</span>
                `;
                    });
            });
        }
        function loadProjectFiles(projectKey) {
            if (!adminSupabase || !projectKey) {
                console.error('√¢¬ù≈í Cannot load project files: adminSupabase or projectKey missing');
                return;
            }
            console.log('√∞≈∏‚Äù¬ç Loading project files for:', projectKey);
            currentEditingProject = projects.find(p => p.key === projectKey);
            // Show loading state
            const grid = document.getElementById('projectGalleryGrid');
            if (grid) {
                grid.innerHTML = '<div class="text-center text-gray-400 text-sm py-8 col-span-full">Loading project files...</div>';
            }
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .list(projectKey, {
                    limit: 1000,
                    sortBy: { column: 'created_at', order: 'desc' }
                })
                .then(function (result) {
                    if (result.error) {
                        console.error('√¢¬ù≈í Error loading project files:', result.error);
                        if (grid) {
                            grid.innerHTML = '<div class="text-center text-red-400 text-sm py-8 col-span-full">Error loading files: ' + result.error.message + '</div>';
                        }
                        return;
                    }
                    console.log('√∞≈∏‚Äú¬Å Raw files from storage:', result.data);
                    if (!result.data || result.data.length === 0) {
                        console.log('√∞≈∏‚Äú¬Å No files found for project:', projectKey);
                        projectFiles = [];
                        if (grid) {
                            grid.innerHTML = '<div class="text-center text-gray-400 text-sm py-8 col-span-full">No files uploaded yet. Create the project first, then upload images and videos.</div>';
                        }
                        return;
                    }
                    projectFiles = result.data
                        .filter(function (file) {
                            const fileName = file.name.toLowerCase();
                            // Filter out thumbnail files, logo files, banner files, and JSON files
                            return !fileName.startsWith('thumb-') &&
                                !fileName.startsWith('logo') &&
                                !fileName.startsWith('banner') &&
                                !fileName.includes('/logo/') &&
                                !fileName.includes('/banner/') &&
                                !fileName.includes('website-assets/logo/') &&
                                !fileName.includes('website-assets/banner/') &&
                                !fileName.endsWith('.json') &&
                                fileName !== 'logo.png' &&
                                fileName !== 'banner.jpg' &&
                                fileName !== 'banner.png';
                        })
                        .map(function (file) {
                            const publicUrlResult = adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .getPublicUrl(projectKey + '/' + file.name);
                            const fileData = {
                                name: file.name,
                                path: projectKey + '/' + file.name,
                                url: publicUrlResult.data.publicUrl,
                                size: file.metadata?.size || 0,
                                created_at: file.created_at,
                                type: getFileType(file.name)
                            };
                            console.log('√∞≈∏‚Äú‚Äû Processed file:', fileData);
                            return fileData;
                        });
                    console.log('√¢≈ì‚Ä¶ Loaded', projectFiles.length, 'project files');
                    displayProjectGallery();
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error loading project files:', error);
                    if (grid) {
                        grid.innerHTML = '<div class="text-center text-red-400 text-sm py-8 col-span-full">Error loading files: ' + error.message + '</div>';
                    }
                });
        }
        function displayProjectGallery() {
            const grid = document.getElementById('projectGalleryGrid');
            const filter = document.getElementById('projectGalleryFilter').value;
            if (!grid) {
                console.error('√¢¬ù≈í Project gallery grid element not found');
                return;
            }
            console.log('√∞≈∏≈Ω¬® Displaying project gallery with', projectFiles.length, 'files');
            let filteredFiles = projectFiles;
            // Apply filter
            if (filter === 'images') {
                filteredFiles = filteredFiles.filter(f => f.type === 'image');
            } else if (filter === 'videos') {
                filteredFiles = filteredFiles.filter(f => f.type === 'video');
            }
            console.log('√∞≈∏‚Äù¬ç After filtering:', filteredFiles.length, 'files (filter:', filter, ')');
            if (filteredFiles.length === 0) {
                const message = projectFiles.length === 0
                    ? 'No files uploaded yet. Upload some images or videos above.'
                    : `No ${filter} found. Try changing the filter or upload more files.`;
                grid.innerHTML = `<div class="text-center text-gray-400 text-sm py-8 col-span-full">${message}</div>`;
                return;
            }
            grid.innerHTML = filteredFiles.map(function (file, index) {
                return `
            <div class="relative group cursor-pointer bg-gray-800 rounded-lg overflow-hidden aspect-square">
                ${file.type === 'image' ?
                        `<img src="${file.url}" alt="${file.name}" class="w-full h-full object-cover" loading="lazy" onerror="this.parentElement.innerHTML='<div class=\\'w-full h-full flex items-center justify-center bg-gray-700\\'>√¢¬ù≈í Failed to load</div>'">` :
                        file.type === 'video' ?
                            `<video class="w-full h-full object-cover" preload="metadata">
                        <source src="${file.url}" type="video/mp4">
                    </video>
                    <div class="absolute inset-0 flex items-center justify-center bg-black/50">
                        <svg class="w-6 h-6 text-white" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                        </svg>
                    </div>` :
                            `<div class="w-full h-full flex items-center justify-center bg-gray-700">
                        <svg class="w-6 h-6 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                        </svg>
                    </div>`
                    }
                <div class="absolute top-1 right-1 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="bg-red-600 hover:bg-red-700 text-white p-1 rounded-full text-xs transition-colors" onclick="deleteProjectFile('${file.path}')" title="Delete file">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 2l2-2h4l2 2h4v2H2V2h4zM3 6v11a1 1 0 001 1h12a1 1 0 001-1V6H3z"/>
                        </svg>
                    </button>
                </div>
                <div class="absolute bottom-0 left-0 right-0 bg-black/75 text-white p-1 text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                    <p class="truncate" title="${file.name}">${file.name}</p>
                    <p class="text-xs text-gray-300">${(file.size / 1024).toFixed(1)} KB</p>
                </div>
            </div>
        `;
            }).join('');
            console.log('√¢≈ì‚Ä¶ Gallery displayed with', filteredFiles.length, 'files');
        }
        function filterProjectGallery() {
            displayProjectGallery();
        }
        function deleteProjectFile(filePath) {
            if (!confirm('Are you sure you want to delete this file?')) return;
            console.log('üóëÔ∏è¬è Deleting file:', filePath);
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .remove([filePath])
                .then(function (result) {
                    if (result.error) {
                        console.error('√¢¬ù≈í Error deleting file:', result.error);
                        showNotification('Error deleting file: ' + result.error.message, 'error');
                        return;
                    }
                    console.log('√¢≈ì‚Ä¶ File deleted successfully:', filePath);
                    showNotification('File deleted successfully', 'success');
                    if (currentEditingProject) {
                        // Reload project files to refresh the gallery
                        loadProjectFiles(currentEditingProject.key);
                        // Update project file count
                        setTimeout(function () {
                            updateProjectFileCount(currentEditingProject.key);
                        }, 1000);
                    }
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error deleting file:', error);
                    showNotification('Error deleting file: ' + error.message, 'error');
                });
        }
        // Gallery Management Functions
        function refreshProjectSelector() {
            const selector = document.getElementById('projectSelector');
            const existingProjects = JSON.parse(localStorage.getItem('projects') || '[]');
            selector.innerHTML = '<option value="">Select a project...</option>';
            existingProjects.forEach(function (project) {
                const option = document.createElement('option');
                option.value = project.id;
                option.textContent = project.title + ' (' + project.key + ')';
                selector.appendChild(option);
            });
        }
        function loadProjectGallery() {
            const projectId = document.getElementById('projectSelector').value;
            const uploadSection = document.getElementById('galleryUploadSection');
            const displaySection = document.getElementById('galleryDisplay');
            if (!projectId) {
                uploadSection.classList.add('hidden');
                displaySection.classList.add('hidden');
                return;
            }
            const project = projects.find(p => p.id === projectId);
            if (!project) return;
            currentProject = project;
            uploadSection.classList.remove('hidden');
            displaySection.classList.remove('hidden');
            // Load existing files from storage
            loadProjectFiles(project.key);
        }
        // Note: loadProjectFiles is defined earlier in the file with full filtering logic
        function getFileType(filename) {
            const ext = filename.split('.').pop().toLowerCase();
            const imageExts = ['jpg', 'jpeg', 'png', 'gif', 'webp', 'svg'];
            const videoExts = ['mp4', 'webm', 'mov', 'avi', 'mkv'];
            if (imageExts.includes(ext)) return 'image';
            if (videoExts.includes(ext)) return 'video';
            return 'other';
        }
        function displayGallery() {
            const grid = document.getElementById('galleryGrid');
            const filter = document.getElementById('galleryFilter').value;
            const sortBy = document.getElementById('gallerySortBy').value;
            let filteredFiles = galleryFiles;
            // Apply filter
            if (filter === 'images') {
                filteredFiles = filteredFiles.filter(f => f.type === 'image');
            } else if (filter === 'videos') {
                filteredFiles = filteredFiles.filter(f => f.type === 'video');
            }
            // Apply sorting
            filteredFiles.sort(function (a, b) {
                switch (sortBy) {
                    case 'newest':
                        return new Date(b.created_at) - new Date(a.created_at);
                    case 'oldest':
                        return new Date(a.created_at) - new Date(b.created_at);
                    case 'name':
                        return a.name.localeCompare(b.name);
                    case 'size':
                        return b.size - a.size;
                    default:
                        return 0;
                }
            });
            grid.innerHTML = filteredFiles.map(function (file, index) {
                const isSelected = selectedFiles.includes(file.path);
                return `
            <div class="relative group cursor-pointer ${isSelected ? 'ring-2 ring-blue-500' : ''}" onclick="toggleFileSelection('${file.path}')">
                <div class="aspect-square bg-gray-800 rounded-lg overflow-hidden">
                    ${file.type === 'image' ?
                        `<img src="${file.url}" alt="${file.name}" class="w-full h-full object-cover">` :
                        file.type === 'video' ?
                            `<video class="w-full h-full object-cover" preload="metadata">
                            <source src="${file.url}" type="video/mp4">
                        </video>
                        <div class="absolute inset-0 flex items-center justify-center bg-black/50">
                            <svg class="w-8 h-8 text-white" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                            </svg>
                        </div>` :
                            `<div class="w-full h-full flex items-center justify-center bg-gray-700">
                            <svg class="w-8 h-8 text-gray-400" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 3a2 2 0 00-2 2v10a2 2 0 002 2h12a2 2 0 002-2V5a2 2 0 00-2-2H4zm12 12H4l4-8 3 6 2-4 3 6z"/>
                            </svg>
                        </div>`
                    }
                </div>
                <div class="absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
                    <button class="bg-red-600 text-white p-1 rounded-full text-xs" onclick="event.stopPropagation(); deleteFile('${file.path}')">
                        <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                            <path d="M6 2l2-2h4l2 2h4v2H2V2h4zM3 6v11a1 1 0 001 1h12a1 1 0 001-1V6H3z"/>
                        </svg>
                    </button>
                </div>
                <div class="absolute bottom-0 left-0 right-0 bg-black/75 text-white p-2 text-xs opacity-0 group-hover:opacity-100 transition-opacity">
                    <p class="truncate">${file.name}</p>
                    <p>${formatFileSize(file.size)}</p>
                </div>
                ${isSelected ? '<div class="absolute top-2 left-2 bg-blue-500 text-white p-1 rounded-full text-xs">√¢≈ì‚Äú</div>' : ''}
            </div>
        `;
            }).join('');
            updateBulkActions();
        }
        function toggleFileSelection(filePath) {
            const index = selectedFiles.indexOf(filePath);
            if (index === -1) {
                selectedFiles.push(filePath);
            } else {
                selectedFiles.splice(index, 1);
            }
            displayGallery();
        }
        function selectAllFiles() {
            selectedFiles = galleryFiles.map(f => f.path);
            displayGallery();
        }
        function deselectAllFiles() {
            selectedFiles = [];
            displayGallery();
        }
        function updateBulkActions() {
            const bulkActions = document.getElementById('bulkActions');
            const selectedCount = document.getElementById('selectedCount');
            selectedCount.textContent = selectedFiles.length;
            if (selectedFiles.length > 0) {
                bulkActions.classList.remove('hidden');
            } else {
                bulkActions.classList.add('hidden');
            }
        }
        function deleteFile(filePath) {
            if (!confirm('Are you sure you want to delete this file?')) return;
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .remove([filePath])
                .then(function (result) {
                    if (result.error) {
                        showNotification('Error deleting file: ' + result.error.message, 'error');
                        return;
                    }
                    showNotification('File deleted successfully', 'success');
                    loadProjectFiles(currentProject.key);
                })
                .catch(function (error) {
                    showNotification('Error deleting file: ' + error.message, 'error');
                });
        }
        function deleteSelectedFiles() {
            if (selectedFiles.length === 0) return;
            if (!confirm(`Are you sure you want to delete ${selectedFiles.length} selected files?`)) return;
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .remove(selectedFiles)
                .then(function (result) {
                    if (result.error) {
                        showNotification('Error deleting files: ' + result.error.message, 'error');
                        return;
                    }
                    showNotification(`${selectedFiles.length} files deleted successfully`, 'success');
                    selectedFiles = [];
                    loadProjectFiles(currentProject.key);
                })
                .catch(function (error) {
                    showNotification('Error deleting files: ' + error.message, 'error');
                });
        }
        function filterGallery() {
            displayGallery();
        }
        function sortGallery() {
            displayGallery();
        }
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        // Website Assets Management Functions
        function loadWebsiteAssets() {
            // Load existing assets from storage
            if (!adminSupabase) return;
            // Load website content and team info
            loadWebsiteContent();
            loadTeamInfo();
        }
        function loadWebsiteContent() {
            console.log('√∞≈∏‚Äú¬• Loading website content from Supabase...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .download(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.content}`)
                .then(function (result) {
                    if (result.error) {
                        console.log('√¢‚Äû¬π√Ø¬∏¬è No saved website content found, using defaults');
                        loadDefaultWebsiteContent();
                        return;
                    }
                    result.data.text().then(function (jsonText) {
                        const content = JSON.parse(jsonText);
                        console.log('√∞≈∏‚Äú¬• Loaded website content from Supabase:', content);
                        // Hero Section
                        document.getElementById('heroTitle').value = content.heroTitle || 'Crafting Digital Experiences That Stand Out';
                        document.getElementById('heroSubtitle').value = content.heroSubtitle || 'Where ideas meet execution.';
                        document.getElementById('heroDescription').value = content.heroDescription || 'Extoll.Co is our space on the internet‚Äîa private hub where we showcase what we build, design, and create. No public posting, no external uploads. Just our team\'s best work. We started Extoll with one purpose: to make it easier for clients to discover our talent and reach out directly for projects.';
                        // About Section
                        document.getElementById('aboutTitle').value = content.aboutTitle || 'About Extoll';
                        document.getElementById('aboutTagline').value = content.aboutTagline || 'Execution-first freelance collective. Powered by Startup Ops.';
                        document.getElementById('aboutDescription').value = content.aboutDescription || 'Extoll is a curated freelance collective built by creators and operators who believe that execution matters more than promises.';
                        // Services Section
                        document.getElementById('servicesTitle').value = content.servicesTitle || 'Services';
                        document.getElementById('servicesDescription').value = content.servicesDescription || 'Professional design and creative services tailored to bring your vision to life';
                        // Contact Information
                        document.getElementById('contactTitle').value = content.contactTitle || 'Or reach me directly';
                        document.getElementById('contactPhone').value = content.contactPhone || '+91 9316158312';
                        document.getElementById('whatsappNumber').value = content.whatsappNumber || '+91 9316158312';
                        document.getElementById('contactEmail').value = content.contactEmail || 'extoll.co.in@gmail.com';
                        document.getElementById('instagramHandle').value = content.instagramHandle || '@ExtollCo';
                        document.getElementById('instagramUrl').value = content.instagramUrl || 'https://instagram.com/extollco';
                        // Portfolio Section
                        document.getElementById('portfolioTitle').value = content.portfolioTitle || 'Portfolio';
                        document.getElementById('portfolioDescription').value = content.portfolioDescription || 'Showcase of our creative work and professional projects across various design disciplines.';
                        console.log('√¢≈ì‚Ä¶ Website content loaded successfully');
                    });
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error loading website content:', error);
                    loadDefaultWebsiteContent();
                });
        }
        function loadDefaultWebsiteContent() {
            console.log('√∞≈∏‚Äú¬ù Loading default website content...');
            // Set default values
            document.getElementById('heroTitle').value = 'Crafting Digital Experiences That Stand Out';
            document.getElementById('heroSubtitle').value = 'Where ideas meet execution.';
            document.getElementById('heroDescription').value = 'Extoll.Co is our space on the internet‚Äîa private hub where we showcase what we build, design, and create. No public posting, no external uploads. Just our team\'s best work. We started Extoll with one purpose: to make it easier for clients to discover our talent and reach out directly for projects.';
            document.getElementById('aboutTitle').value = 'About Extoll';
            document.getElementById('aboutTagline').value = 'Execution-first freelance collective. Powered by Startup Ops.';
            document.getElementById('aboutDescription').value = 'Extoll is a curated freelance collective built by creators and operators who believe that execution matters more than promises.';
            document.getElementById('servicesTitle').value = 'Services';
            document.getElementById('servicesDescription').value = 'Professional design and creative services tailored to bring your vision to life';
            document.getElementById('contactTitle').value = 'Or reach me directly';
            document.getElementById('contactPhone').value = '+91 9316158312';
            document.getElementById('whatsappNumber').value = '+91 9316158312';
            document.getElementById('contactEmail').value = 'extoll.co.in@gmail.com';
            document.getElementById('instagramHandle').value = '@ExtollCo';
            document.getElementById('instagramUrl').value = 'https://instagram.com/extollco';
            document.getElementById('portfolioTitle').value = 'Portfolio';
            document.getElementById('portfolioDescription').value = 'Showcase of our creative work and professional projects across various design disciplines.';
        }
        function loadTeamInfo() {
            console.log('üë• Loading team information from Supabase...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .download(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`)
                .then(function (result) {
                    if (result.error) {
                        console.log('√¢‚Äû¬π√Ø¬∏¬è No saved team info found, using defaults');
                        loadDefaultTeamInfo();
                        return;
                    }
                    result.data.text().then(function (jsonText) {
                        const team = JSON.parse(jsonText);
                        console.log('üë• Loaded team info from Supabase:', team);
                        document.getElementById('teamSectionTitle').value = team.sectionTitle || 'Our Team & Capabilities';
                        // Load dynamic team members
                        if (team.members && Array.isArray(team.members)) {
                            loadDynamicTeamMembers(team.members);
                        } else {
                            // Fallback to old format for backward compatibility
                            const members = [
                                { name: team.team1Name || 'Ritesh', role: team.team1Role || 'Leads Graphic Design, 3D Modeling, UI/UX Design, Web Development, and App Development, focusing on building visually strong and technically sound products.' },
                                { name: team.team2Name || 'Nikhil', role: team.team2Role || 'Specializes in 2D Animation, Video Editing, UI/UX Design, Web Development, and App Development, bringing motion, storytelling, and polished digital experiences to every project.' },
                                { name: team.team3Name || 'Yuvraj Gupta', role: team.team3Role || 'Manages promotions, client coordination, and social media operations, ensuring smooth communication and strong brand presence across platforms.' },
                                { name: team.team4Name || 'Arpit', role: team.team4Role || 'Handles Web Development, Client Management, and Social Media Operations, bridging technical execution with client requirements and ongoing support.' }
                            ];
                            loadDynamicTeamMembers(members);
                        }
                        console.log('√¢≈ì‚Ä¶ Team information loaded successfully');
                    });
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error loading team information:', error);
                    loadDefaultTeamInfo();
                });
        }
        function loadDefaultTeamInfo() {
            console.log('üë• Loading default team information...');
            // Set default values
            document.getElementById('teamSectionTitle').value = 'Our Team & Capabilities';
            // Load default team members
            const defaultMembers = [
                { name: 'Ritesh', role: 'Leads Graphic Design, 3D Modeling, UI/UX Design, Web Development, and App Development, focusing on building visually strong and technically sound products.' },
                { name: 'Nikhil', role: 'Specializes in 2D Animation, Video Editing, UI/UX Design, Web Development, and App Development, bringing motion, storytelling, and polished digital experiences to every project.' },
                { name: 'Yuvraj Gupta', role: 'Manages promotions, client coordination, and social media operations, ensuring smooth communication and strong brand presence across platforms.' },
                { name: 'Arpit', role: 'Handles Web Development, Client Management, and Social Media Operations, bridging technical execution with client requirements and ongoing support.' }
            ];
            loadDynamicTeamMembers(defaultMembers);
        }
        function loadDynamicTeamMembers(members) {
            console.log('üë• Loading dynamic team members:', members);
            const container = document.getElementById('teamMembersContainer');
            if (!container) {
                console.error('√¢¬ù≈í Team members container not found');
                return;
            }
            // Clear existing content
            container.innerHTML = '';
            // Add each team member
            members.forEach(function (member, index) {
                addTeamMemberToDOM(member.name, member.role, index);
            });
        }
        function addTeamMemberToDOM(name, role, index, imageUrl) {
            const container = document.getElementById('teamMembersContainer');
            if (!container) {
                console.error('‚ùå Team members container not found');
                return;
            }
            const memberDiv = document.createElement('div');
            memberDiv.className = 'bg-gray-800/50 p-6 rounded-lg';
            memberDiv.setAttribute('data-member-index', index);
            memberDiv.innerHTML = `
        <div class="flex justify-between items-start mb-4">
            <h4 class="text-lg font-semibold text-white">Team Member ${index + 1}</h4>
            <button type="button" class="text-red-400 hover:text-red-300 text-sm" onclick="removeTeamMember(${index})">
                Remove
            </button>
        </div>
        <div class="grid grid-cols-1 md:grid-cols-[1fr,150px] gap-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Name</label>
                    <input type="text" id="teamMember${index}Name" class="form-input" placeholder="Team member name" value="${name || ''}">
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-300 mb-2">Role & Description</label>
                    <textarea id="teamMember${index}Role" class="form-textarea" rows="3" placeholder="Describe their role and capabilities">${role || ''}</textarea>
                </div>
            </div>
            
            <!-- Image Upload Section -->
            <div class="flex flex-col items-center">
                <label class="block text-sm font-medium text-gray-300 mb-2 w-full text-center">Profile Photo</label>
                <div id="teamMember${index}Preview" class="w-full aspect-[4/5] bg-gray-900 rounded-lg border-2 border-dashed border-gray-700 flex items-center justify-center overflow-hidden mb-2 relative group">
                    ${imageUrl ? `<img src="${imageUrl}" class="w-full h-full object-cover" />` : '<span class="text-gray-600 text-3xl font-bold opacity-30">IMG</span>'}
                    <div class="absolute inset-0 bg-black/60 opacity-0 group-hover:opacity-100 transition-opacity flex items-center justify-center">
                        <p class="text-white text-xs cursor-pointer">Change</p>
                    </div>
                    <input type="file" class="absolute inset-0 opacity-0 cursor-pointer" accept="image/*" onchange="handleTeamMemberImageUpload(this.files[0], ${index})">
                </div>
                <input type="hidden" id="teamMember${index}Image" value="${imageUrl || ''}">
                <p id="teamMember${index}UploadStatus" class="text-xs text-gray-500 text-center">Click to upload</p>
            </div>
        </div>
    `;
            container.appendChild(memberDiv);
        }
        function addTeamMember() {
            console.log('√¢≈æ‚Ä¢ Adding new team member');
            const container = document.getElementById('teamMembersContainer');
            if (!container) {
                console.error('√¢¬ù≈í Team members container not found');
                return;
            }
            // Get current number of team members
            const currentMembers = container.querySelectorAll('[data-member-index]');
            const newIndex = currentMembers.length;
            // Add new team member to DOM
            addTeamMemberToDOM('', '', newIndex, '');
            showNotification('New team member added', 'success');
        }
        function removeTeamMember(index) {
            console.log('√¢≈æ‚Äì Removing team member at index:', index);
            const container = document.getElementById('teamMembersContainer');
            if (!container) {
                console.error('√¢¬ù≈í Team members container not found');
                return;
            }
            const memberDiv = container.querySelector(`[data-member-index="${index}"]`);
            if (memberDiv) {
                memberDiv.remove();
                // Re-index remaining members
                const remainingMembers = container.querySelectorAll('[data-member-index]');
                remainingMembers.forEach(function (member, newIndex) {
                    member.setAttribute('data-member-index', newIndex);
                    // Update the header
                    const header = member.querySelector('h4');
                    if (header) {
                        header.textContent = `Team Member ${newIndex + 1}`;
                    }
                    // Update the remove button
                    const removeBtn = member.querySelector('button[onclick*="removeTeamMember"]');
                    if (removeBtn) {
                        removeBtn.setAttribute('onclick', `removeTeamMember(${newIndex})`);
                    }
                    // Update input IDs
                    const nameInput = member.querySelector('input[type="text"]');
                    const roleTextarea = member.querySelector('textarea');
                    if (nameInput) {
                        nameInput.id = `teamMember${newIndex}Name`;
                    }
                    if (roleTextarea) {
                        roleTextarea.id = `teamMember${newIndex}Role`;
                    }
                });
                showNotification('Team member removed', 'success');
            } else {
                console.error('√¢¬ù≈í Team member not found at index:', index);
            }
        }
        function saveTeamInfo() {
            console.log('üë• Saving team information to Supabase...');
            // Change button to saving state
            const saveBtn = document.getElementById('saveTeamBtn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saving...';
            saveBtn.disabled = true;
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                // Reset button
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
                return;
            }
            try {
                const container = document.getElementById('teamMembersContainer');
                if (!container) {
                    console.error('√¢¬ù≈í Team members container not found');
                    showNotification('Error: Team members container not found', 'error');
                    return;
                }
                // Collect all team members
                const memberElements = container.querySelectorAll('[data-member-index]');
                const members = [];
                memberElements.forEach(function (memberElement, index) {
                    const nameInput = memberElement.querySelector(`#teamMember${index}Name`);
                    const roleTextarea = memberElement.querySelector(`#teamMember${index}Role`);
                    const imageInput = memberElement.querySelector(`#teamMember${index}Image`);

                    if (nameInput && roleTextarea) {
                        const name = nameInput.value.trim();
                        const role = roleTextarea.value.trim();
                        const imageUrl = imageInput ? imageInput.value.trim() : '';

                        if (name || role) { // Only save if there's content
                            members.push({
                                name: name,
                                role: role,
                                imageUrl: imageUrl
                            });
                        }
                    }
                });
                const team = {
                    sectionTitle: document.getElementById('teamSectionTitle').value,
                    members: members,
                    updatedAt: new Date().toISOString()
                };
                console.log('üë• Team data to save to Supabase:', team);
                // Save as JSON file to Supabase storage
                const teamBlob = new Blob([JSON.stringify(team, null, 2)], { type: 'application/json' });
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`, teamBlob, {
                        cacheControl: '0',
                        upsert: true
                    })
                    .then(function (result) {
                        console.log('üë• Supabase save result:', result);
                        if (result.error) {
                            console.error('√¢¬ù≈í Save error:', result.error);
                            showNotification('Error saving team information: ' + result.error.message, 'error');
                            // Reset button on error
                            const saveBtn = document.getElementById('saveTeamBtn');
                            saveBtn.textContent = 'Save Team Information';
                            saveBtn.disabled = false;
                            return;
                        }
                        console.log('√¢≈ì‚Ä¶ Team information saved to Supabase successfully');
                        showNotification('Team information saved successfully!', 'success');
                        // Change button to saved state
                        const saveBtn = document.getElementById('saveTeamBtn');
                        saveBtn.textContent = '√¢≈ì‚Ä¶ Saved';
                        saveBtn.disabled = false;
                        // Reset button after 3 seconds
                        setTimeout(function () {
                            saveBtn.textContent = 'Save Team Information';
                        }, 3000);
                    })
                    .catch(function (error) {
                        console.error('√¢¬ù≈í Save catch error:', error);
                        showNotification('Error saving team information: ' + error.message, 'error');
                        // Reset button on error
                        const saveBtn = document.getElementById('saveTeamBtn');
                        saveBtn.textContent = 'Save Team Information';
                        saveBtn.disabled = false;
                    });
            } catch (error) {
                console.error('√¢¬ù≈í Error preparing team information:', error);
                showNotification('Error saving team information: ' + error.message, 'error');
                // Reset button on error
                const saveBtn = document.getElementById('saveTeamBtn');
                saveBtn.textContent = 'Save Team Information';
                saveBtn.disabled = false;
            }
        }
        function saveWebsiteContent() {
            console.log('üíæ Saving website content to Supabase...');
            // Change button to saving state
            const saveBtn = document.getElementById('saveContentBtn');
            const originalText = saveBtn.textContent;
            saveBtn.textContent = 'Saving...';
            saveBtn.disabled = true;
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                // Reset button
                saveBtn.textContent = originalText;
                saveBtn.disabled = false;
                return;
            }
            try {
                const content = {
                    // Hero Section
                    heroTitle: document.getElementById('heroTitle').value,
                    heroSubtitle: document.getElementById('heroSubtitle').value,
                    heroDescription: document.getElementById('heroDescription').value,
                    // About Section
                    aboutTitle: document.getElementById('aboutTitle').value,
                    aboutTagline: document.getElementById('aboutTagline').value,
                    aboutDescription: document.getElementById('aboutDescription').value,
                    // Services Section
                    servicesTitle: document.getElementById('servicesTitle').value,
                    servicesDescription: document.getElementById('servicesDescription').value,
                    // Contact Information
                    contactTitle: document.getElementById('contactTitle').value,
                    contactPhone: document.getElementById('contactPhone').value,
                    whatsappNumber: document.getElementById('whatsappNumber').value,
                    contactEmail: document.getElementById('contactEmail').value,
                    instagramHandle: document.getElementById('instagramHandle').value,
                    instagramUrl: document.getElementById('instagramUrl').value,
                    // Portfolio Section
                    portfolioTitle: document.getElementById('portfolioTitle').value,
                    portfolioDescription: document.getElementById('portfolioDescription').value,
                    // Logo and Banner URLs (preserve existing if not changed)
                    logoUrl: window.currentLogoUrl || null,
                    bannerUrl: window.currentBannerUrl || null,
                    // Metadata
                    updatedAt: new Date().toISOString()
                };
                console.log('üíæ Content to save to Supabase:', content);
                // Save as JSON file to Supabase storage (use main bucket since metadata bucket might not exist)
                const contentBlob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload('website-config/website-content.json', contentBlob, {
                        cacheControl: '0',  // No caching - always serve fresh content
                        upsert: true
                    })
                    .then(function (result) {
                        console.log('üíæ Supabase save result:', result);
                        if (result.error) {
                            console.error('√¢¬ù≈í Save error:', result.error);
                            showNotification('Error saving website content: ' + result.error.message, 'error');
                            // Reset button on error
                            const saveBtn = document.getElementById('saveContentBtn');
                            saveBtn.textContent = 'Save All Content';
                            saveBtn.disabled = false;
                            return;
                        }
                        console.log('√¢≈ì‚Ä¶ Website content saved to Supabase successfully');
                        showNotification('All website content saved successfully!', 'success');
                        // Change button to saved state
                        const saveBtn = document.getElementById('saveContentBtn');
                        saveBtn.textContent = '√¢≈ì‚Ä¶ Saved';
                        saveBtn.disabled = false;
                        // Reset button after 3 seconds
                        setTimeout(function () {
                            saveBtn.textContent = 'Save All Content';
                        }, 3000);
                    })
                    .catch(function (error) {
                        console.error('√¢¬ù≈í Save catch error:', error);
                        showNotification('Error saving website content: ' + error.message, 'error');
                        // Reset button on error
                        const saveBtn = document.getElementById('saveContentBtn');
                        saveBtn.textContent = 'Save All Content';
                        saveBtn.disabled = false;
                    });
            } catch (error) {
                console.error('√¢¬ù≈í Error preparing website content:', error);
                showNotification('Error saving website content: ' + error.message, 'error');
                // Reset button on error
                const saveBtn = document.getElementById('saveContentBtn');
                saveBtn.textContent = 'Save All Content';
                saveBtn.disabled = false;
            }
        }
        function testWebsiteContent() {
            console.log('√∞≈∏¬ß¬™ Testing website content from Supabase...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                return;
            }
            // Load website content from Supabase
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .download('website-config/website-content.json')
                .then(function (result) {
                    if (result.error) {
                        console.error('√¢¬ù≈í No website-config/website-content.json found:', result.error);
                        showNotification('No website-config/website-content.json file found in Supabase', 'error');
                        return;
                    }
                    return result.data.text().then(function (jsonText) {
                        const content = JSON.parse(jsonText);
                        console.log('√∞≈∏‚Äú‚Äû Current website-config/website-content.json:', content);
                        // Show banner info specifically
                        if (content.bannerUrl) {
                            console.log('√¢≈ì‚Ä¶ Banner URL found:', content.bannerUrl);
                            showNotification(`Banner URL found: ${content.bannerUrl}`, 'success');
                        } else {
                            console.log('√¢¬ù≈í No banner URL in website content');
                            showNotification('No banner URL found in website content', 'error');
                        }
                        // Show full content in alert for easy viewing
                        alert('Website Content:\n\n' + JSON.stringify(content, null, 2));
                    });
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error testing website content:', error);
                    showNotification('Error loading website content: ' + error.message, 'error');
                });
        }
        // Filename sanitization function for JSON safety
        function sanitizeFilename(filename) {
            console.log('√∞≈∏¬ß¬π Sanitizing filename:', filename);
            // Get file extension
            const lastDotIndex = filename.lastIndexOf('.');
            const name = lastDotIndex > 0 ? filename.substring(0, lastDotIndex) : filename;
            const extension = lastDotIndex > 0 ? filename.substring(lastDotIndex) : '';
            // Sanitize the name part
            let sanitized = name
                // Replace problematic characters with safe alternatives
                .replace(/['"\\]/g, '') // Remove quotes and backslashes
                .replace(/[<>:"/|?*]/g, '-') // Replace Windows forbidden chars with dash
                .replace(/\s+/g, '_') // Replace spaces with underscores
                .replace(/[^\w\-_.]/g, '') // Keep only alphanumeric, dash, underscore, dot
                .replace(/_{2,}/g, '_') // Replace multiple underscores with single
                .replace(/-{2,}/g, '-') // Replace multiple dashes with single
                .replace(/^[._-]+|[._-]+$/g, '') // Remove leading/trailing dots, underscores, dashes
                .substring(0, 100); // Limit length to 100 characters
            // Ensure we have a valid name
            if (!sanitized) {
                sanitized = 'file_' + Date.now();
            }
            const result = sanitized + extension.toLowerCase();
            console.log('√¢≈ì‚Ä¶ Sanitized filename:', filename, '√¢‚Ä†‚Äô', result);
            return result;
        }
        function testSupabaseUpload() {
            console.log('√∞≈∏¬ß¬™ Testing Supabase upload functionality...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                return;
            }
            // Create a simple test file
            const testContent = 'This is a test file created at ' + new Date().toISOString();
            const testFile = new Blob([testContent], { type: 'text/plain' });
            const testPath = 'test-upload.txt';
            console.log('√∞≈∏‚Äú¬§ Testing upload to:', testPath);
            console.log('√∞≈∏‚Äù¬ß Test configuration:', {
                bucket: SUPABASE_CONFIG.bucket,
                adminSupabase: !!adminSupabase,
                fileSize: testFile.size,
                fileType: testFile.type
            });
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .upload(testPath, testFile, {
                    cacheControl: '0',
                    upsert: true
                })
                .then(function (result) {
                    console.log('√∞≈∏‚Äú¬§ Test upload result:', result);
                    if (result.error) {
                        console.error('√¢¬ù≈í Test upload error:', result.error);
                        showNotification('Test upload failed: ' + result.error.message, 'error');
                        // Check specific error types
                        if (result.error.message.includes('not found')) {
                            showNotification('Bucket not found. Check if extoll-portfolio bucket exists.', 'error');
                        } else if (result.error.message.includes('access denied') || result.error.message.includes('unauthorized')) {
                            showNotification('Access denied. Check authentication and bucket policies.', 'error');
                        } else if (result.error.message.includes('Invalid JWT')) {
                            showNotification('Authentication expired. Try logging out and back in.', 'error');
                        }
                        return;
                    }
                    console.log('√¢≈ì‚Ä¶ Test upload successful!');
                    showNotification('Test upload successful! Upload functionality is working.', 'success');
                    // Clean up test file
                    adminSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .remove([testPath])
                        .then(function (deleteResult) {
                            console.log('√∞≈∏‚Äî‚Äò√Ø¬∏¬è Test file cleanup:', deleteResult);
                        });
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Test upload catch error:', error);
                    showNotification('Test upload failed: ' + error.message, 'error');
                });
        }
        function fixWebsiteContentUrls() {
            console.log('√∞≈∏‚Äù¬ß Fixing website content URLs...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                return;
            }
            showNotification('Checking for logo and banner files...', 'info');
            // Check for logo and banner files in their respective folders
            Promise.all([
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}`),
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}`)
            ])
                .then(function ([logoResult, bannerResult]) {
                    console.log('√∞≈∏‚Äú¬Å Logo files:', logoResult);
                    console.log('√∞≈∏‚Äú¬Å Banner files:', bannerResult);
                    const logoFile = logoResult.data && logoResult.data.length > 0 ? logoResult.data[0].name : null;
                    const bannerFile = bannerResult.data && bannerResult.data.length > 0 ? bannerResult.data[0].name : null;
                    console.log('√∞≈∏‚Äú¬∑ Found logo:', logoFile);
                    console.log('√∞≈∏‚Äì¬º√Ø¬∏¬è Found banner:', bannerFile);
                    if (!logoFile && !bannerFile) {
                        showNotification('No logo or banner files found in storage', 'warning');
                        return;
                    }
                    // Load existing website content from portfolio bucket
                    return adminSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .download(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.content}`)
                        .then(function (result) {
                            let content = {};
                            if (!result.error && result.data) {
                                return result.data.text().then(function (jsonText) {
                                    content = JSON.parse(jsonText);
                                    return content;
                                });
                            } else {
                                console.log('√¢‚Äû¬π√Ø¬∏¬è No existing website content, creating new');
                                return content;
                            }
                        })
                        .then(function (content) {
                            // Add logo and banner URLs
                            if (logoFile) {
                                content.logoUrl = logoFile;
                                window.currentLogoUrl = logoFile;
                                console.log('√¢≈ì‚Ä¶ Added logoUrl:', logoFile);
                            }
                            if (bannerFile) {
                                content.bannerUrl = bannerFile;
                                window.currentBannerUrl = bannerFile;
                                console.log('√¢≈ì‚Ä¶ Added bannerUrl:', bannerFile);
                            }
                            content.updatedAt = new Date().toISOString();
                            console.log('√∞≈∏‚Äô¬æ Saving fixed website content:', content);
                            // Save updated content
                            const contentBlob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
                            return adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .upload(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.content}`, contentBlob, {
                                    cacheControl: '0',
                                    upsert: true
                                });
                        })
                        .then(function (result) {
                            if (result.error) {
                                console.error('√¢¬ù≈í Error saving fixed content:', result.error);
                                showNotification('Error saving fixed content: ' + result.error.message, 'error');
                                return;
                            }
                            console.log('√¢≈ì‚Ä¶ Website content fixed successfully');
                            showNotification('Logo and banner URLs added to website content! Refresh homepage to see changes.', 'success');
                        });
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error fixing website content:', error);
                    showNotification('Error fixing website content: ' + error.message, 'error');
                });
        }
        function testDirectAssetLoad() {
            console.log('√∞≈∏¬ß¬™ Testing direct asset loading...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            // Check what files exist in logo and banner folders
            Promise.all([
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}`),
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}`)
            ])
                .then(function ([logoResult, bannerResult]) {
                    console.log('√∞≈∏‚Äú¬Å Logo folder result:', logoResult);
                    console.log('√∞≈∏‚Äú¬Å Banner folder result:', bannerResult);
                    if (logoResult.data && logoResult.data.length > 0) {
                        const logoFile = logoResult.data[0];
                        const logoUrl = adminSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .getPublicUrl(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}/` + logoFile.name);
                        console.log('√∞≈∏‚Äú¬∑ Logo URL:', logoUrl);
                        // Test if we can load the logo
                        const testImg = new Image();
                        testImg.onload = function () {
                            console.log('√¢≈ì‚Ä¶ Logo loads successfully:', logoUrl.data.publicUrl);
                            showNotification('Logo file loads successfully: ' + logoFile.name, 'success');
                        };
                        testImg.onerror = function () {
                            console.error('√¢¬ù≈í Logo failed to load:', logoUrl.data.publicUrl);
                            showNotification('Logo file failed to load: ' + logoFile.name, 'error');
                        };
                        testImg.src = logoUrl.data.publicUrl;
                    } else {
                        console.log('√¢‚Äû¬π√Ø¬∏¬è No logo files found');
                        showNotification('No logo files found in storage', 'warning');
                    }
                    if (bannerResult.data && bannerResult.data.length > 0) {
                        const bannerFile = bannerResult.data[0];
                        const bannerUrl = adminSupabase.storage
                            .from(SUPABASE_CONFIG.bucket)
                            .getPublicUrl(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}/` + bannerFile.name);
                        console.log('√∞≈∏‚Äì¬º√Ø¬∏¬è Banner URL:', bannerUrl);
                        // Test if we can load the banner
                        const testImg = new Image();
                        testImg.onload = function () {
                            console.log('√¢≈ì‚Ä¶ Banner loads successfully:', bannerUrl.data.publicUrl);
                            showNotification('Banner file loads successfully: ' + bannerFile.name, 'success');
                        };
                        testImg.onerror = function () {
                            console.error('√¢¬ù≈í Banner failed to load:', bannerUrl.data.publicUrl);
                            showNotification('Banner file failed to load: ' + bannerFile.name, 'error');
                        };
                        testImg.src = bannerUrl.data.publicUrl;
                    } else {
                        console.log('√¢‚Äû¬π√Ø¬∏¬è No banner files found');
                        showNotification('No banner files found in storage', 'warning');
                    }
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error testing direct asset load:', error);
                    showNotification('Error testing assets: ' + error.message, 'error');
                });
        }
        function createSimpleWebsiteContent() {
            console.log('√∞≈∏‚Äù¬ß Creating simple website content with logo/banner URLs...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            showNotification('Creating website content file...', 'info');
            // Check for logo and banner files
            Promise.all([
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}`),
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}`)
            ])
                .then(function ([logoResult, bannerResult]) {
                    const logoFile = logoResult.data && logoResult.data.length > 0 ? logoResult.data[0].name : null;
                    const bannerFile = bannerResult.data && bannerResult.data.length > 0 ? bannerResult.data[0].name : null;
                    console.log('√∞≈∏‚Äú¬∑ Found logo:', logoFile);
                    console.log('√∞≈∏‚Äì¬º√Ø¬∏¬è Found banner:', bannerFile);
                    // Create simple website content
                    const content = {
                        heroTitle: "Crafting Digital Experiences That Stand Out",
                        heroSubtitle: "Where ideas meet execution.",
                        heroDescription: "Extoll.Co is our space on the internet√¢‚Ç¨‚Äùa private hub where we showcase what we build, design, and create. No public posting, no external uploads. Just our team's best work. We started Extoll with one purpose: to make it easier for clients to discover our talent and reach out directly for projects.",
                        aboutTitle: "About Extoll",
                        aboutTagline: "Execution-first freelance collective. Powered by Startup Ops.",
                        portfolioTitle: "Portfolio",
                        portfolioDescription: "Showcase of our creative work and professional projects across various design disciplines.",
                        updatedAt: new Date().toISOString()
                    };
                    // Add logo and banner URLs if files exist
                    if (logoFile) {
                        content.logoUrl = logoFile;
                        window.currentLogoUrl = logoFile;
                        console.log('√¢≈ì‚Ä¶ Added logoUrl:', logoFile);
                    }
                    if (bannerFile) {
                        content.bannerUrl = bannerFile;
                        window.currentBannerUrl = bannerFile;
                        console.log('√¢≈ì‚Ä¶ Added bannerUrl:', bannerFile);
                    }
                    console.log('√∞≈∏‚Äô¬æ Creating website content:', content);
                    // Save to main bucket (since metadata bucket might not exist)
                    const contentBlob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
                    return adminSupabase.storage
                        .from(SUPABASE_CONFIG.bucket)
                        .upload('website-config/website-content.json', contentBlob, {
                            cacheControl: '0',
                            upsert: true
                        });
                })
                .then(function (result) {
                    console.log('√∞≈∏‚Äô¬æ Save result:', result);
                    if (result.error) {
                        console.error('√¢¬ù≈í Error saving to main bucket:', result.error);
                        showNotification('Error creating website content: ' + result.error.message, 'error');
                        return;
                    }
                    console.log('√¢≈ì‚Ä¶ Website content created successfully in main bucket');
                    showNotification('Website content created! Now update homepage to load from main bucket.', 'success');
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error creating website content:', error);
                    showNotification('Error creating website content: ' + error.message, 'error');
                });
        }
        function updateHomepageAssetsNow() {
            console.log('√∞≈∏≈°‚Ç¨ Updating homepage assets directly...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            showNotification('Scanning for logo and banner files...', 'info');
            // Get logo and banner files
            Promise.all([
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}`),
                adminSupabase.storage.from(SUPABASE_CONFIG.bucket).list(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}`)
            ])
                .then(function ([logoResult, bannerResult]) {
                    console.log('√∞≈∏‚Äú¬Å Logo files:', logoResult);
                    console.log('√∞≈∏‚Äú¬Å Banner files:', bannerResult);
                    const logoFile = logoResult.data && logoResult.data.length > 0 ? logoResult.data[0].name : null;
                    const bannerFile = bannerResult.data && bannerResult.data.length > 0 ? bannerResult.data[0].name : null;
                    if (!logoFile && !bannerFile) {
                        showNotification('No logo or banner files found. Please upload them first.', 'warning');
                        return;
                    }
                    // Create simple update instructions
                    let instructions = 'Go to homepage, open console (F12), and run:\n\n';
                    if (logoFile) {
                        instructions += 'Logo update:\n';
                        instructions += 'const logo = document.querySelector(".website-logo, .nav-logo");\n';
                        instructions += 'if (logo) logo.src = "' + adminSupabase.storage.from(SUPABASE_CONFIG.bucket).getPublicUrl(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.logo}/` + logoFile).data.publicUrl + '";\n\n';
                    }
                    if (bannerFile) {
                        instructions += 'Banner update:\n';
                        instructions += 'const banner = document.querySelector(".hero-banner");\n';
                        instructions += 'if (banner) banner.src = "' + adminSupabase.storage.from(SUPABASE_CONFIG.bucket).getPublicUrl(`${SUPABASE_CONFIG.websiteAssets.folder}/${SUPABASE_CONFIG.websiteAssets.subfolders.banner}/` + bannerFile).data.publicUrl + '";\n\n';
                    }
                    // Show instructions in alert
                    alert('Copy and run this in homepage console:\n\n' + instructions);
                    showNotification('Instructions shown! Copy the code and run it on homepage.', 'success');
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error updating homepage assets:', error);
                    showNotification('Error: ' + error.message, 'error');
                });
        }
        function createAndTestContent() {
            console.log('√∞≈∏¬ß¬™ Creating and testing website content...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                return;
            }
            // Get current form values
            const content = {
                heroTitle: document.getElementById('heroTitle')?.value || "Crafting Digital Experiences That Stand Out",
                heroSubtitle: document.getElementById('heroSubtitle')?.value || "Where ideas meet execution.",
                heroDescription: document.getElementById('heroDescription')?.value || "Extoll.Co is our space on the internet√¢‚Ç¨‚Äùa private hub where we showcase what we build, design, and create.",
                aboutTitle: document.getElementById('aboutTitle')?.value || "About Extoll",
                aboutTagline: document.getElementById('aboutTagline')?.value || "Execution-first freelance collective. Powered by Startup Ops.",
                aboutDescription: document.getElementById('aboutDescription')?.value || "Extoll is a curated freelance collective built by creators and operators who believe that execution matters more than promises.",
                servicesTitle: document.getElementById('servicesTitle')?.value || "Services",
                servicesDescription: document.getElementById('servicesDescription')?.value || "Professional design and creative services tailored to bring your vision to life",
                contactTitle: document.getElementById('contactTitle')?.value || "Or reach me directly",
                contactPhone: document.getElementById('contactPhone')?.value || "+91 9316158312",
                whatsappNumber: document.getElementById('whatsappNumber')?.value || "+91 9316158312",
                contactEmail: document.getElementById('contactEmail')?.value || "extoll.co.in@gmail.com",
                instagramHandle: document.getElementById('instagramHandle')?.value || "@ExtollCo",
                instagramUrl: document.getElementById('instagramUrl')?.value || "https://instagram.com/extollco",
                portfolioTitle: document.getElementById('portfolioTitle')?.value || "Portfolio",
                portfolioDescription: document.getElementById('portfolioDescription')?.value || "Showcase of our creative work and professional projects across various design disciplines.",
                updatedAt: new Date().toISOString()
            };
            // Get team info
            const container = document.getElementById('teamMembersContainer');
            let teamMembers = [];
            if (container) {
                const memberElements = container.querySelectorAll('[data-member-index]');
                memberElements.forEach(function (memberElement, index) {
                    const nameInput = memberElement.querySelector(`#teamMember${index}Name`);
                    const roleTextarea = memberElement.querySelector(`#teamMember${index}Role`);
                    if (nameInput && roleTextarea) {
                        const name = nameInput.value.trim();
                        const role = roleTextarea.value.trim();
                        if (name || role) {
                            teamMembers.push({ name: name, role: role });
                        }
                    }
                });
            }
            // Default team members if none found
            if (teamMembers.length === 0) {
                teamMembers = [
                    { name: 'Ritesh', role: 'Leads Graphic Design, 3D Modeling, UI/UX Design, Web Development, and App Development, focusing on building visually strong and technically sound products.' },
                    { name: 'Nikhil', role: 'Specializes in 2D Animation, Video Editing, UI/UX Design, Web Development, and App Development, bringing motion, storytelling, and polished digital experiences to every project.' },
                    { name: 'Yuvraj Gupta', role: 'Manages promotions, client coordination, and social media operations, ensuring smooth communication and strong brand presence across platforms.' },
                    { name: 'Arpit', role: 'Handles Web Development, Client Management, and Social Media Operations, bridging technical execution with client requirements and ongoing support.' }
                ];
            }
            const teamInfo = {
                sectionTitle: document.getElementById('teamSectionTitle')?.value || 'Our Team & Capabilities',
                members: teamMembers,
                updatedAt: new Date().toISOString()
            };
            console.log('√∞≈∏‚Äô¬æ Content to save:', content);
            console.log('√∞≈∏‚Äò¬• Team info to save:', teamInfo);
            showNotification('Creating website content and team info files...', 'info');
            // Save both files to main bucket
            const contentBlob = new Blob([JSON.stringify(content, null, 2)], { type: 'application/json' });
            const teamBlob = new Blob([JSON.stringify(teamInfo, null, 2)], { type: 'application/json' });
            Promise.all([
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload('website-config/website-content.json', contentBlob, {
                        cacheControl: '0',
                        upsert: true
                    }),
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`, teamBlob, {
                        cacheControl: '0',
                        upsert: true
                    })
            ])
                .then(function (results) {
                    const [contentResult, teamResult] = results;
                    if (contentResult.error) {
                        console.error('√¢¬ù≈í Content upload error:', contentResult.error);
                        showNotification('Error uploading website content: ' + contentResult.error.message, 'error');
                        return;
                    }
                    if (teamResult.error) {
                        console.error('√¢¬ù≈í Team upload error:', teamResult.error);
                        showNotification('Error uploading team info: ' + teamResult.error.message, 'error');
                        return;
                    }
                    console.log('√¢≈ì‚Ä¶ Both content files created successfully');
                    showNotification('Website content and team info created! Refresh homepage, about page, and contact page to see updates.', 'success');
                    // Test loading content back
                    setTimeout(function () {
                        Promise.all([
                            adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .download('website-config/website-content.json'),
                            adminSupabase.storage
                                .from(SUPABASE_CONFIG.bucket)
                                .download(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`)
                        ])
                            .then(function (testResults) {
                                const [contentTest, teamTest] = testResults;
                                if (contentTest.data && teamTest.data) {
                                    Promise.all([
                                        contentTest.data.text(),
                                        teamTest.data.text()
                                    ])
                                        .then(function (texts) {
                                            const [contentText, teamText] = texts;
                                            const loadedContent = JSON.parse(contentText);
                                            const loadedTeam = JSON.parse(teamText);
                                            console.log('√¢≈ì‚Ä¶ Content verified:', loadedContent);
                                            console.log('√¢≈ì‚Ä¶ Team info verified:', loadedTeam);
                                            showNotification('All content verified! Pages should now update with new content.', 'success');
                                        });
                                }
                            });
                    }, 1000);
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error creating content:', error);
                    showNotification('Error: ' + error.message, 'error');
                });
        }
        // File Upload Functions for Gallery
        function handleGalleryImageUpload(files) {
            if (!currentProject || !adminSupabase) return;
            const progressList = document.getElementById('uploadProgressList');
            const progressSection = document.getElementById('uploadProgress');
            progressSection.classList.remove('hidden');
            Array.from(files).forEach(function (file, index) {
                const fileName = 'img-' + Date.now() + '-' + index + '.' + file.name.split('.').pop();
                const filePath = currentProject.key + '/' + fileName;
                const progressItem = document.createElement('div');
                progressItem.className = 'flex justify-between items-center p-2 bg-gray-700 rounded';
                progressItem.innerHTML = `
            <span class="text-white">${file.name}</span>
            <span class="text-gray-400">Uploading...</span>
        `;
                progressList.appendChild(progressItem);
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(filePath, file, {
                        cacheControl: '0',
                        upsert: true
                    })
                    .then(function (result) {
                        if (result.error) {
                            progressItem.innerHTML = `
                        <span class="text-white">${file.name}</span>
                        <span class="text-red-400">Failed</span>
                    `;
                            return;
                        }
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-green-400">√¢≈ì‚Äú Uploaded</span>
                `;
                        // Refresh gallery after upload
                        setTimeout(function () {
                            loadProjectFiles(currentProject.key);
                        }, 1000);
                    })
                    .catch(function (error) {
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-red-400">Error</span>
                `;
                    });
            });
        }
        function handleGalleryVideoUpload(files) {
            if (!currentProject || !adminSupabase) return;
            const progressList = document.getElementById('uploadProgressList');
            const progressSection = document.getElementById('uploadProgress');
            progressSection.classList.remove('hidden');
            Array.from(files).forEach(function (file, index) {
                const fileName = 'vid-' + Date.now() + '-' + index + '.' + file.name.split('.').pop();
                const filePath = currentProject.key + '/' + fileName;
                const progressItem = document.createElement('div');
                progressItem.className = 'flex justify-between items-center p-2 bg-gray-700 rounded';
                progressItem.innerHTML = `
            <span class="text-white">${file.name}</span>
            <span class="text-gray-400">Uploading...</span>
        `;
                progressList.appendChild(progressItem);
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .upload(filePath, file, {
                        cacheControl: '0',
                        upsert: true
                    })
                    .then(function (result) {
                        if (result.error) {
                            progressItem.innerHTML = `
                        <span class="text-white">${file.name}</span>
                        <span class="text-red-400">Failed</span>
                    `;
                            return;
                        }
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-green-400">√¢≈ì‚Äú Uploaded</span>
                `;
                        // Refresh gallery after upload
                        setTimeout(function () {
                            loadProjectFiles(currentProject.key);
                        }, 1000);
                    })
                    .catch(function (error) {
                        progressItem.innerHTML = `
                    <span class="text-white">${file.name}</span>
                    <span class="text-red-400">Error</span>
                `;
                    });
            });
        }
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-button').forEach(function (button) {
                button.addEventListener('click', function (e) {
                    const tab = e.target.getAttribute('data-tab');
                    switchTab(tab);
                });
            });
            // File upload area
            const uploadArea = document.getElementById('testUpload');
            const fileInput = document.getElementById('testFileInput');
            if (uploadArea && fileInput) {
                uploadArea.addEventListener('click', function () {
                    fileInput.click();
                });
                uploadArea.addEventListener('dragover', function (e) {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                uploadArea.addEventListener('dragleave', function () {
                    uploadArea.classList.remove('dragover');
                });
                uploadArea.addEventListener('drop', function (e) {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileSelect(files[0]);
                    }
                });
                fileInput.addEventListener('change', function (e) {
                    if (e.target.files.length > 0) {
                        handleFileSelect(e.target.files[0]);
                    }
                });
            }
            // Project form
            const projectForm = document.getElementById('projectForm');
            const titleInput = document.getElementById('projectTitle');
            const keyInput = document.getElementById('projectKey');
            const thumbnailArea = document.getElementById('thumbnailUpload');
            const thumbnailInput = document.getElementById('thumbnailInput');
            if (titleInput && keyInput) {
                titleInput.addEventListener('input', function (e) {
                    // Only auto-generate key for NEW projects, not when editing
                    if (!currentEditingProject) {
                        const key = generateProjectKey(e.target.value);
                        keyInput.value = key;
                    }
                    // When editing, keep the existing key to prevent duplication
                });
            }
            if (thumbnailArea && thumbnailInput) {
                thumbnailArea.addEventListener('click', function () {
                    thumbnailInput.click();
                });
                thumbnailInput.addEventListener('change', function (e) {
                    if (e.target.files.length > 0) {
                        handleThumbnailSelect(e.target.files[0]);
                    }
                });
            }
            if (projectForm) {
                projectForm.addEventListener('submit', handleProjectSubmit);
            }
            // Project upload areas
            const projectImageArea = document.getElementById('projectImageUpload');
            const projectImageInput = document.getElementById('projectImageInput');
            const projectVideoArea = document.getElementById('projectVideoUpload');
            const projectVideoInput = document.getElementById('projectVideoInput');
            if (projectImageArea && projectImageInput) {
                console.log('√¢≈ì‚Ä¶ Project image upload area found, attaching event listeners');
                projectImageArea.addEventListener('click', function () {
                    console.log('√∞≈∏‚Äú¬∑ Project image upload area clicked');
                    projectImageInput.click();
                });
                projectImageInput.addEventListener('change', function (e) {
                    console.log('√∞≈∏‚Äú¬∑ Project image files selected:', e.target.files.length);
                    if (e.target.files.length > 0) {
                        handleProjectImageUpload(e.target.files);
                    }
                });
            } else {
                console.error('√¢¬ù≈í Project image upload elements not found:', {
                    area: !!projectImageArea,
                    input: !!projectImageInput
                });
            }
            if (projectVideoArea && projectVideoInput) {
                console.log('√¢≈ì‚Ä¶ Project video upload area found, attaching event listeners');
                projectVideoArea.addEventListener('click', function () {
                    console.log('√∞≈∏≈Ω¬• Project video upload area clicked');
                    projectVideoInput.click();
                });
                projectVideoInput.addEventListener('change', function (e) {
                    console.log('√∞≈∏≈Ω¬• Project video files selected:', e.target.files.length);
                    if (e.target.files.length > 0) {
                        handleProjectVideoUpload(e.target.files);
                    }
                });
            } else {
                console.error('√¢¬ù≈í Project video upload elements not found:', {
                    area: !!projectVideoArea,
                    input: !!projectVideoInput
                });
            }
            // Filter change listeners
            const filterCategory = document.getElementById('filterCategory');
            if (filterCategory) {
                filterCategory.addEventListener('change', displayProjects);
            }
        }
        // Initialize
        document.addEventListener('DOMContentLoaded', function () {
            console.log('√∞≈∏≈°‚Ç¨ Admin panel initializing...');
            // Initialize Supabase using the config file functions
            if (typeof window.supabase !== 'undefined') {
                // Initialize the shared Supabase client from config
                const initResult = initializeSupabase();
                if (initResult) {
                    adminSupabase = configSupabase; // Use the same client as the config functions
                    console.log('√¢≈ì‚Ä¶ Supabase initialized using shared client');
                    // Test Supabase connection
                    testSupabaseConnection();
                } else {
                    console.error('√¢¬ù≈í Failed to initialize Supabase from config');
                }
            } else {
                console.warn('√¢≈°¬†√Ø¬∏¬è Supabase not loaded');
            }
            // Setup event listeners
            const loginForm = document.getElementById('loginForm');
            if (loginForm) {
                loginForm.addEventListener('submit', handleLogin);
                console.log('√¢≈ì‚Ä¶ Login form event listener attached');
            }
            const logoutBtn = document.getElementById('logoutBtn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', handleLogout);
            }
            setupEventListeners();
            // Initialize debug functions
            debugProjectFiles();
            // Check if user is already authenticated instead of always showing login
            checkAuthenticationState();
            // Monitor authentication state changes
            if (adminSupabase) {
                adminSupabase.auth.onAuthStateChange((event, session) => {
                    console.log('√∞≈∏‚Äù‚Äû Auth state changed:', event, session?.user?.email);
                    if (event === 'SIGNED_OUT' || !session) {
                        console.log('√∞≈∏≈°¬™ User signed out or session expired');
                        currentUser = null;
                        showLogin();
                        showNotification('Session expired. Please login again.', 'warning');
                    } else if (event === 'SIGNED_IN' && session?.user) {
                        console.log('√¢≈ì‚Ä¶ User signed in:', session.user.email);
                        currentUser = {
                            email: session.user.email,
                            authenticated: true,
                            source: 'supabase'
                        };
                        // Don't auto-show dashboard here as it might be called during manual login
                    }
                });
            }
            console.log('√¢≈ì‚Ä¶ Admin panel initialized successfully');
        });
        function testContactUpdate() {
            console.log('√∞≈∏‚Äú≈æ Testing contact update functionality...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                return;
            }
            // Get current contact values from form
            const testContent = {
                contactTitle: document.getElementById('contactTitle')?.value || 'Test Contact Title - Updated ' + new Date().toLocaleTimeString(),
                contactPhone: document.getElementById('contactPhone')?.value || '+91 1234567890',
                whatsappNumber: document.getElementById('whatsappNumber')?.value || '+91 1234567890',
                contactEmail: document.getElementById('contactEmail')?.value || 'test@extoll.co',
                instagramHandle: document.getElementById('instagramHandle')?.value || '@TestExtoll',
                instagramUrl: document.getElementById('instagramUrl')?.value || 'https://instagram.com/testextoll',
                updatedAt: new Date().toISOString()
            };
            console.log('√∞≈∏‚Äú≈æ Test contact data:', testContent);
            showNotification('Creating test contact content...', 'info');
            // Save test content
            const contentBlob = new Blob([JSON.stringify(testContent, null, 2)], { type: 'application/json' });
            adminSupabase.storage
                .from(SUPABASE_CONFIG.bucket)
                .upload('website-config/website-content.json', contentBlob, {
                    cacheControl: '0',
                    upsert: true
                })
                .then(function (result) {
                    if (result.error) {
                        console.error('√¢¬ù≈í Error saving test contact content:', result.error);
                        showNotification('Error saving test content: ' + result.error.message, 'error');
                        return;
                    }
                    console.log('√¢≈ì‚Ä¶ Test contact content saved successfully');
                    showNotification('Test contact content saved! Now open contact.html page to see updates.', 'success');
                    // Also show the test data
                    const testInfo = `Test Contact Data Saved:
Contact Title: ${testContent.contactTitle}
Phone: ${testContent.contactPhone}
WhatsApp: ${testContent.whatsappNumber}
Email: ${testContent.contactEmail}
Instagram Handle: ${testContent.instagramHandle}
Instagram URL: ${testContent.instagramUrl}
Instructions:
1. Open contact.html page in browser
2. Check browser console for loading messages
3. Verify contact details are updated
4. If not working, try refreshing the page
5. Use browser dev tools to debug`;
                    alert(testInfo);
                    console.log('√∞≈∏‚Äú≈æ Test contact info:', testInfo);
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Error creating test contact content:', error);
                    showNotification('Error: ' + error.message, 'error');
                });
        }
        function debugContentLoading() {
            console.log('√∞≈∏‚Äù¬ç Debugging content loading...');
            if (!adminSupabase) {
                console.error('√¢¬ù≈í Supabase not initialized');
                showNotification('Error: Supabase not connected', 'error');
                return;
            }
            showNotification('Checking content files...', 'info');
            // Check both website-config/website-content.json and team-info.json
            Promise.all([
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .download('website-config/website-content.json'),
                adminSupabase.storage
                    .from(SUPABASE_CONFIG.bucket)
                    .download(`${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`)
            ])
                .then(function (results) {
                    const [contentResult, teamResult] = results;
                    console.log('√∞≈∏‚Äú‚Äû Website content result:', contentResult);
                    console.log('√∞≈∏‚Äò¬• Team info result:', teamResult);
                    let debugInfo = 'Content Debug Results:\n\n';
                    if (contentResult.error) {
                        debugInfo += '√¢¬ù≈í Website Content: ' + contentResult.error.message + '\n';
                    } else {
                        contentResult.data.text().then(function (contentText) {
                            const content = JSON.parse(contentText);
                            debugInfo += '√¢≈ì‚Ä¶ Website Content Found:\n';
                            debugInfo += '  - Hero Title: ' + (content.heroTitle || 'Not set') + '\n';
                            debugInfo += '  - Contact Email: ' + (content.contactEmail || 'Not set') + '\n';
                            debugInfo += '  - Contact Phone: ' + (content.contactPhone || 'Not set') + '\n';
                            debugInfo += '  - Instagram Handle: ' + (content.instagramHandle || 'Not set') + '\n';
                            debugInfo += '  - Updated At: ' + (content.updatedAt || 'Not set') + '\n\n';
                            if (teamResult.error) {
                                debugInfo += '√¢¬ù≈í Team Info: ' + teamResult.error.message + '\n';
                                alert(debugInfo);
                            } else {
                                teamResult.data.text().then(function (teamText) {
                                    const team = JSON.parse(teamText);
                                    debugInfo += '√¢≈ì‚Ä¶ Team Info Found:\n';
                                    debugInfo += '  - Section Title: ' + (team.sectionTitle || 'Not set') + '\n';
                                    if (team.members && Array.isArray(team.members)) {
                                        debugInfo += '  - Team Members (' + team.members.length + '):\n';
                                        team.members.forEach(function (member, index) {
                                            debugInfo += '    ' + (index + 1) + '. ' + (member.name || 'No name') + '\n';
                                        });
                                    } else if (team.team1Name) {
                                        debugInfo += '  - Legacy Format: ' + team.team1Name + ', ' + team.team2Name + ', etc.\n';
                                    } else {
                                        debugInfo += '  - No team members found\n';
                                    }
                                    debugInfo += '  - Updated At: ' + (team.updatedAt || 'Not set') + '\n\n';
                                    debugInfo += 'Instructions:\n';
                                    debugInfo += '1. Save content using "Save All Content" button\n';
                                    debugInfo += '2. Save team info using "Save Team Information" button\n';
                                    debugInfo += '3. Refresh homepage, about page, and contact page\n';
                                    debugInfo += '4. Check browser console for loading errors\n';
                                    alert(debugInfo);
                                    console.log('√∞≈∏‚Äú‚Äπ Debug Info:', debugInfo);
                                    showNotification('Debug complete - check console and alert for details', 'success');
                                });
                            }
                        });
                    }
                })
                .catch(function (error) {
                    console.error('√¢¬ù≈í Debug error:', error);
                    showNotification('Debug failed: ' + error.message, 'error');
                });
        }
        // Test Supabase connection and configuration
        async function testSupabaseConnection() {
            try {
                console.log('√∞≈∏¬ß¬™ Testing Supabase connection...');
                // Test basic connection
                if (!adminSupabase) {
                    throw new Error('Supabase client not initialized');
                }
                // Test if we can access the public bucket
                const { data: publicBuckets, error: publicError } = await adminSupabase.storage.listBuckets();
                if (publicError) {
                    console.warn('√¢≈°¬†√Ø¬∏¬è Could not list buckets:', publicError.message);
                } else {
                    console.log('√¢≈ì‚Ä¶ Supabase connection successful');
                    // Check if required bucket exists
                    const portfolioBucket = publicBuckets.find(b => b.name === SUPABASE_CONFIG.bucket);
                    console.log('√∞≈∏‚Äú¬¶ Bucket status:');
                    console.log(`   ${SUPABASE_CONFIG.bucket}: ${portfolioBucket ? '√¢≈ì‚Ä¶ Found' : '√¢¬ù≈í Missing'}`);
                    if (!portfolioBucket) {
                        console.error('√∞≈∏‚Äô¬° Create bucket:', SUPABASE_CONFIG.bucket, '(set to PUBLIC)');
                    }
                }
            } catch (error) {
                console.error('√¢¬ù≈í Supabase connection test failed:', error.message);
            }
        }
    </script>
</body>

</html>
<script>
    // Update admin panel to use new file paths
    function updateAdminPanelPaths() {
        // Replace all instances of old paths with new ones
        const oldWebsiteContentPath = 'website-content.json';
        const newWebsiteContentPath = `${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.content}`;
        const oldTeamInfoPath = 'team-info.json';
        const newTeamInfoPath = `${SUPABASE_CONFIG.globalSettings.folder}/${SUPABASE_CONFIG.globalSettings.files.team}`;
        console.log('√¢≈ì‚Ä¶ Admin panel updated to use new file paths');
        console.log('√∞≈∏‚Äú¬Å Website content:', newWebsiteContentPath);
        console.log('√∞≈∏‚Äò¬• Team info:', newTeamInfoPath);
    }
    // Call on page load
    document.addEventListener('DOMContentLoaded', updateAdminPanelPaths);
</script>